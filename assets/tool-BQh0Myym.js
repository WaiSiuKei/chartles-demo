var e=Object.defineProperty,i=(i,t,s)=>((i,t,s)=>t in i?e(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s)(i,"symbol"!=typeof t?t+"":t,s);import{G as t,A as s,u as n,bF as r,cm as o,J as a,L as c}from"./index-5gyre0hA.js";import{T as l,a as p,D as h}from"./toolPaneView-BkZhzbTB.js";import{ao as d}from"./index-iNH1zFVl.js";import{P as x}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as w}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as u,T as m}from"./axisPaneView-B6qY_qE1.js";import{C as _}from"./composite-CCMtJLBO.js";import{R as P}from"./rectangle-E0x1RaIQ.js";import"./baseTool-BM5mqL4_.js";class y extends l{constructor(){super(...arguments),i(this,"_renderer",new _(this._hitTestCollector)),i(this,"_rectangleRenderer",new P)}renderer(){return this._renderer}_updateImpl(){if(this._renderer.clear(),this.points().length<2)return;const e=this._source.properties(),i=e.extendLeft,t=e.extendRight,s={points:this.points(),color:e.color,lineWidth:e.lineWidth,lineStyle:e.lineStyle,backColor:e.backColor,extendLeft:i,extendRight:t};this._renderer.append(this._rectangleRenderer),this._rectangleRenderer.setData(s),this._addAnchors()}_addAnchors(){const[e,i]=this.points(),c=e.x-i.x,l=e.y-i.y,p=Math.sign(c*l),h=p<0?t.nesw:t.nwse,d=p<0?t.nwse:t.nesw,x=[new s(e,{pointIndex:0,cursorType:h}),new s(i,{pointIndex:1,cursorType:h}),new s(new n(e.x,i.y),{pointIndex:2,cursorType:d}),new s(new n(i.x,e.y),{pointIndex:3,cursorType:d}),new s(new n(e.x,(e.y+i.y)/2),{pointIndex:4,resizeDirections:o,style:r.square}),new s(new n(i.x,(e.y+i.y)/2),{pointIndex:5,resizeDirections:o,style:r.square}),new s(new n((e.x+i.x)/2,e.y),{pointIndex:6,resizeDirections:a,style:r.square}),new s(new n((e.x+i.x)/2,i.y),{pointIndex:7,resizeDirections:a,style:r.square})],w=this.createLineAnchor({points:x},0);this._renderer.append(w)}}class A extends p{constructor(){super(...arguments),i(this,"_lines",new y(this,this.model)),i(this,"_paneView",[this._lines]),i(this,"_priceAxisPaneViews",[new u(Object.create(null))]),i(this,"_timeAxisPaneViews",[new m(Object.create(null))]),i(this,"_timeAxisViews",[new w(Object.create(null)),new w(Object.create(null))]),i(this,"_priceAxisViews",[new x(Object.create(null)),new x(Object.create(null))])}pointsCount(){return 2}setPoint(e,i,t){if(e<2)return super.setPoint(e,i,t);switch(e){case 2:this.controlPoints[1].price=t.endPrice,this.controlPoints[0].time=t.endTime;break;case 3:this.controlPoints[0].price=t.endPrice,this.controlPoints[1].time=t.endTime;break;case 4:this.controlPoints[0].time=t.endTime;break;case 5:this.controlPoints[1].time=t.endTime;break;case 6:this.controlPoints[0].price=t.endPrice;break;case 7:this.controlPoints[1].price=t.endPrice}}updateAllViews(){const[e,i]=this.controlPoints;if(!e)return;const t=this.pointToScreenPoint(e);if(!t)return;const n=[new s(t,{pointIndex:0})];if(i){const r=this.pointToScreenPoint(i);if(!r)return;n.push(new s(r,{pointIndex:1})),this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(t.y,r.y)),this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(t.x,r.x)),this._priceAxisViews[0].update(this._calculatePriceAxisViewData(e.price,t.y)),this._priceAxisViews[1].update(this._calculatePriceAxisViewData(i.price,r.y)),this._timeAxisViews[0].update(this._calculateTimeAxisViewData(e.time,t.x)),this._timeAxisViews[1].update(this._calculateTimeAxisViewData(i.time,r.x))}this._lines.update({points:n})}}class b extends h{constructor(){super(...arguments),i(this,"type",d)}createPrimitive(){return new A({id:this.id,points:[],color:"#9C27B0FF",lineWidth:2,lineStyle:c.solid,backColor:"#9C27B033",extendLeft:!1,extendRight:!1},...this.resetArgs)}}export{b as RectangleTool};
