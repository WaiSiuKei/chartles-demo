var e=Object.defineProperty,t=(t,i,r)=>((t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r)(t,"symbol"!=typeof i?i+"":i,r);import{T as i,a as r,D as s}from"./toolPaneView-BkZhzbTB.js";import{$ as n}from"./index-iNH1zFVl.js";import{P as o}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as a}from"./timeLabelTimeAxisView-DLVMuesT.js";import{L as l,u as d,bH as c,r as h,y as p,z as x,A as w}from"./index-5gyre0hA.js";import{P as m,T as u}from"./axisPaneView-B6qY_qE1.js";import{H as _,V as b,c as f}from"./text-BhorOBkg.js";import{C as y}from"./composite-CCMtJLBO.js";import{L as g}from"./line-BKuOqRrm.js";import{R as A}from"./rectangle-E0x1RaIQ.js";import{T as R}from"./renderer-CaYvdS1S.js";import"./baseTool-BM5mqL4_.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";class P extends i{constructor(){super(...arguments),t(this,"_topBorderRenderer",new g),t(this,"_bottomBorderRenderer",new g),t(this,"_distanceRenderer",new g),t(this,"_backgroundRenderer",new A),t(this,"_labelRenderer",new R),t(this,"_renderer",new y(this._hitTestCollector))}renderer(){return this._renderer}_updateImpl(){if(this._renderer.clear(),this.points().length<2)return;const e=this._source.properties(),t=e.extendLeft,i=e.extendRight,[r,s]=this.points(),n=Math.min(r.x,s.x),o=Math.max(r.x,s.x);this._backgroundRenderer.setData({points:[new d(n,r.y),new d(o,s.y)],color:"white",lineWidth:0,lineStyle:l.solid,backColor:e.background,extendLeft:t,extendRight:i}),this._renderer.append(this._backgroundRenderer);const a=(r,s,n)=>{r.setData({points:[s,n],lineColor:e.lineColor,lineWidth:e.lineWidth,lineStyle:l.solid,extendLeft:t,extendRight:i,leftEnd:c.Normal,rightEnd:c.Normal}),this._renderer.append(r)};let w=n,m=o;w===m&&(t&&(w-=1),i&&(m+=1)),a(this._topBorderRenderer,new d(w,r.y),new d(m,r.y)),a(this._bottomBorderRenderer,new d(w,s.y),new d(m,s.y));const u=Math.round((r.x+s.x)/2),y=new d(u,r.y),g=new d(u,s.y),{mediaSize:{height:A}}=this._source.getScope();let R;this._distanceRenderer.setData({points:[y,g],lineColor:e.lineColor,lineWidth:e.lineWidth,lineStyle:l.solid,extendLeft:!1,extendRight:!1,leftEnd:c.Normal,rightEnd:Math.abs(y.y-g.y)>=15*e.lineWidth?c.Arrow:c.Normal}),this._renderer.append(this._distanceRenderer),R=s.y>r.y?new d(.5*(r.x+s.x),s.y-2*e.fontSize):new d(.5*(r.x+s.x),s.y+.7*e.fontSize);const P={x:0,y:10},V=e.fontSize,F={points:[R],text:this._data.labelText,color:e.textColor,fontFamily:h,offsetX:P.x,offsetY:P.y,lineSpacing:8,vertAlign:b.Middle,horzAlign:_.Center,fontSize:V,backgroundRoundRect:4,boxPaddingHorz:.4*V+V/3,boxPaddingVert:.2*V+V/3,boxShadow:{shadowColor:e.boxShadow,shadowBlur:4,shadowOffsetY:1},backgroundColor:e.labelBackground};this._labelRenderer.setData(F);const j=this._labelRenderer.measure(),S=f(j,r,s,P,A);this._labelRenderer.setPoint(S),this._labelRenderer.setHitTestResult(new p(x.MovePoint)),this._renderer.append(this._labelRenderer),this.addAnchors(this._renderer)}}class V extends r{constructor(){super(...arguments),t(this,"_lines",new P(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new m(Object.create(null))]),t(this,"_timeAxisPaneViews",[new u(Object.create(null))]),t(this,"_timeAxisViews",[new a(Object.create(null)),new a(Object.create(null))]),t(this,"_priceAxisViews",[new o(Object.create(null)),new o(Object.create(null))])}pointsCount(){return 2}updateAllViews(){if(!this.controlPoints.length)return;const[e,t]=this.controlPoints;if(!t)return;const i=this.pointToScreenPoint(e);if(!i)return;const r=this.pointToScreenPoint(t);if(!r)return;const s=[new w(i,{pointIndex:0}),new w(r,{pointIndex:1})];this._timeAxisViews[0].update(this._calculateTimeAxisViewData(e.time,i.x)),this._priceAxisViews[0].update(this._calculatePriceAxisViewData(e.price,i.y)),this._timeAxisViews[1].update(this._calculateTimeAxisViewData(t.time,r.x)),this._priceAxisViews[1].update(this._calculatePriceAxisViewData(t.price,r.y)),this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(i.y,r.y)),this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(i.x,r.x));const n=t.price-e.price,o=n/e.price,a=n*this._props.base;this._lines.update({points:s,labelText:`${this._ctx.priceLabelFormatter(n)} (${this._ctx.percentageFormatter(o)}) ${a.toFixed(0)}`})}}class F extends s{constructor(){super(...arguments),t(this,"type",n)}createPrimitive(){return new V({id:this.id,points:[],lineColor:"#2962FFFF",lineWidth:2,background:"#2962FF26",textColor:"#000000FF",fontSize:12,labelBackground:"#FFFFFF",base:this.chartService.symbolInfo().pricescale,drawBorder:!1,borderWidth:2,borderColor:"#2962FFFF",boxShadow:"#00000033",extendLeft:!1,extendRight:!1},...this.resetArgs)}}export{F as PriceRangeTool};
