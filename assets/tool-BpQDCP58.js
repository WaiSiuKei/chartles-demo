var e=Object.defineProperty,t=(t,i,n)=>((t,i,n)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n)(t,"symbol"!=typeof i?i+"":i,n);import{u as i,A as n,bF as s,J as r,G as o,L as l}from"./index-5gyre0hA.js";import{T as a,a as c,D as h}from"./toolPaneView-BkZhzbTB.js";import{j as p}from"./index-iNH1zFVl.js";import{P as d}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as u}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as m,T as _}from"./axisPaneView-B6qY_qE1.js";import{C as w}from"./composite-CCMtJLBO.js";import{D as x}from"./disjointChannel-BfVJD7oN.js";import{L as P}from"./line-BKuOqRrm.js";import"./baseTool-BM5mqL4_.js";import"./parallelChannel-DC2OIzzc.js";import"./line-Jebc4sVj.js";class f extends a{constructor(){super(...arguments),t(this,"_trendLineRendererPoints12",new P),t(this,"_trendLineRendererPoints43",new P),t(this,"_disjointChannelRenderer",new x),t(this,"_renderer",new w(this._hitTestCollector))}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this.points();if((null==e?void 0:e.length)<2)return;const t=this._source.properties(),[l,a]=e;let c,h;if(e.length>=3){c=new i(a.x,e[2].y);const n=a.y-l.y;h=new i(l.x,c.y+n),t.fillBackground&&(this._disjointChannelRenderer.setData({extendleft:!!t.extendLeft,extendright:!!t.extendRight,points:[l,a,c,h],fillBackground:!0,backcolor:t.background}),this._renderer.append(this._disjointChannelRenderer))}this._trendLineRendererPoints12.setData(this._createLineStyle(l,a,t)),this._renderer.append(this._trendLineRendererPoints12),c&&h&&(this._trendLineRendererPoints43.setData(this._createLineStyle(h,c,t)),this._renderer.append(this._trendLineRendererPoints43));const p=[l,a];c&&p.push(new n(c,{pointIndex:2,cursorType:o.ns,resizeDirections:r,style:s.square})),h&&p.push(new n(h,{pointIndex:3})),this._model.currentCreating===this._source&&p.pop(),this._renderer.append(this.createLineAnchor({points:p},0))}_createLineStyle(e,t,i){return{points:[e,t],lineColor:i.lineColor,lineWidth:i.lineWidth,lineStyle:i.lineStyle,extendLeft:i.extendLeft,extendRight:i.extendRight,leftEnd:i.leftEnd,rightEnd:i.rightEnd}}}class j extends c{constructor(){super(...arguments),t(this,"_lines",new f(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new m(Object.create(null))]),t(this,"_timeAxisPaneViews",[new _(Object.create(null))]),t(this,"_timeAxisViews",[new u(Object.create(null)),new u(Object.create(null)),new u(Object.create(null))]),t(this,"_priceAxisViews",[new d(Object.create(null)),new d(Object.create(null)),new d(Object.create(null))])}pointsCount(){return 3}setPoint(e,t,i){const n=.5*(this.controlPoints[1].price+this.controlPoints[2].price);if(e<3&&super.setPoint(e,t,i),0!==e&&2!==e)if(1===e){const e=this.controlPoints[1].price-n;this.controlPoints[2].price=this.controlPoints[1].price-2*e}else if(3===e){const e=t.price-this.controlPoints[2].price;this.controlPoints[0].price=this.controlPoints[1].price-e,this.controlPoints[0].time=t.time}}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let s=0;s<this.controlPoints.length;s++){const t=this.controlPoints[s],i=this.pointToScreenPoint(t);if(!i)return;e.push(new n(i,{pointIndex:s}))}const t=e.map((e=>e.x)),i=e.map((e=>e.y));this.controlPoints.forEach(((t,i)=>{this._timeAxisViews[i].update(this._calculateTimeAxisViewData(t.time,e[i].x)),this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,e[i].y))})),t.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,t),Math.max.apply(null,t))),i.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,i),Math.max.apply(null,i))),this._lines.update({points:e})}}class y extends h{constructor(){super(...arguments),t(this,"type",p)}createPrimitive(){return new j({id:this.id,points:[],lineColor:"#089981FF",lineWidth:2,lineStyle:l.solid,fillBackground:!0,background:"#08998133"},...this.resetArgs)}}export{y as DisjointChannelTool};
