var e=Object.defineProperty,t=(t,i,r)=>((t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r)(t,"symbol"!=typeof i?i+"":i,r);import{T as i,a as r,D as o}from"./toolPaneView-BkZhzbTB.js";import{P as s}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as n}from"./timeLabelTimeAxisView-DLVMuesT.js";import{B as a,y as l,z as h,c4 as c,bV as d,A as p}from"./index-5gyre0hA.js";import{C as u}from"./composite-CCMtJLBO.js";var w=(e=>(e.up="up",e.down="down",e.left="left",e.right="right",e))(w||{});class _ extends a{drawImpl(e){if(!this._data)return;const{color:t,direction:i,points:r}=this._data,o=r[0],s=e.context;s.fillStyle=t,"up"===i||"down"===i?this._drawVerticalArrow(s,o,i,e):"left"!==i&&"right"!==i||this._drawHorizontalArrow(s,o,i,e)}_drawVerticalArrow(e,t,i,r){const{horizontalPixelRatio:o,verticalPixelRatio:s}=r,n=Math.max(1,Math.floor(o))%2?.5:0,a="up"===i?1:-1,l=a*Math.round(12*s),h=c(19.5*o)/2+n,d=a*Math.round(10*s),p=c(10*o)/2+n,u=Math.round(t.x*o)+n,w=Math.round(t.y*s);e.beginPath(),e.moveTo(u,w),e.lineTo(u+h,w+l),e.lineTo(u+p,w+l),e.lineTo(u+p,w+l+d),e.lineTo(u-p,w+l+d),e.lineTo(u-p,w+l),e.lineTo(u-h,w+l),e.closePath(),e.fill()}_drawHorizontalArrow(e,t,i,r){const{horizontalPixelRatio:o,verticalPixelRatio:s}=r,n=Math.max(1,Math.floor(o))%2?.5:0,a="left"===i?1:-1,l=a*Math.round(12*o)+n,h=c(19.5*s)/2+n,d=a*Math.round(22*o)+n,p=c(10*s)/2+n,u=Math.round(t.x*o)+n,w=Math.round(t.y*s)+n;e.beginPath(),e.moveTo(u,w),e.lineTo(u+l,w+h),e.lineTo(u+l,w+p),e.lineTo(u+d,w+p),e.lineTo(u+d,w-p),e.lineTo(u+l,w-p),e.lineTo(u+l,w-h),e.closePath(),e.fill()}hitTest(e){if(!this._data)return null;const{direction:t,points:i}=this._data,r=i[0],o=19.5,s=19.5;let n,a,c,d;switch(t){case"up":n=r.x-9.75,a=n+o,c=r.y,d=c+22;break;case"down":n=r.x-9.75,a=n+o,d=r.y,c=d-22;break;case"left":n=r.x,a=n+22,c=r.y-9.75,d=c+s;break;case"right":a=r.x,n=a-22,c=r.y-9.75,d=c+s;break;default:return null}const{x:p,y:u}=e;return p>=n&&p<=a&&u>=c&&u<=d?new l(h.MovePoint):null}}class x extends i{constructor(){super(...arguments),t(this,"_renderer",new u(this._hitTestCollector)),t(this,"_arrowMarkRenderer",new _)}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this._source.properties();this._arrowMarkRenderer.setData({points:this.points(),color:e.color,direction:e.direction}),this._renderer.append(this._arrowMarkRenderer),this._renderer.append(new d({points:this.points(),bgColors:this._lineAnchorColors(this.points()),visible:this.areAnchorsVisible(),hitTarget:h.MovePoint}))}}class m extends r{constructor(){super(...arguments),t(this,"_lines",new x(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_timeAxisViews",[new n(Object.create(null))]),t(this,"_priceAxisViews",[new s(Object.create(null))])}pointsCount(){return 1}updateAllViews(){if(!this.controlPoints.length)return;const[e]=this.controlPoints,t=this.pointToScreenPoint(e);if(!t)return;const i=new p(t,{pointIndex:0});this._timeAxisViews[0].update(this._calculateTimeAxisViewData(e.time,t.x)),this._priceAxisViews[0].update(this._calculatePriceAxisViewData(e.price,t.y)),this._lines.update({points:[i]})}}class f extends o{constructor(){super(...arguments),t(this,"direction",w.up)}createPrimitive(){return new m({id:this.id,points:[],color:"#089981FF",direction:this.direction},...this.resetArgs)}}export{f as A,w as a};
