var t=Object.defineProperty,n=(n,e,s)=>((n,e,s)=>e in n?t(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s)(n,"symbol"!=typeof e?e+"":e,s);import{B as e,bI as s,L as i,aZ as a,b0 as r,bJ as o,bK as l,bL as d,y as c,z as u,e as h,u as b,bH as f,bM as p,w as x,bN as m,bO as w,bP as y,bQ as g,bR as _,bS as v}from"./index-5gyre0hA.js";class A extends e{constructor(){super(...arguments),n(this,"_scope")}drawImpl(t){const n=t.context;if(!this._data)return;const e=this._data;if("points"in e&&e.points.length<2)return;this._scope=t;const{horizontalPixelRatio:l}=t;if(void 0!==e.excludeBoundaries){n.save();for(const n of e.excludeBoundaries)s(t,n)}const d=e.lineStyle,c=e.lineCap??(d===i.solid?"round":"butt");n.lineCap=c,n.lineJoin="round",n.strokeStyle=e.lineColor,n.lineWidth=Math.max(1,Math.floor(e.lineWidth*l)),a(n,d);const u=e.points[0],h=e.points[1];n.beginPath(),e.overlayLineEndings?r():this._drawEnds(n,[u,h],e.lineWidth,t),this._drawEnds(n,[u,h],e.lineWidth,t);const b=this._extendAndClipLineSegment(u,h,t);null!==b&&e.lineWidth>0&&o(n,b[0].x,b[0].y,b[1].x,b[1].y,t),e.overlayLineEndings&&r(),n.stroke(),void 0!==e.excludeBoundaries&&n.restore()}hitTest(t){const n=this._scope,e=this._data;if(!e||!n)return null;if(e.points.length<2)return null;const s=(e.hitTestTolerance??l().line)+e.lineWidth/2,i=e.points[0],a=e.points[1],r=this._extendAndClipLineSegment(i,a,n);if(null!==r){if(d(r[0],r[1],t).distance<=s)return new c(u.MovePoint)}return null}_extendAndClipLineSegment(t,n,e){const s=h(this._data),{width:i,height:a}=e.mediaSize,{extendLeft:r,extendRight:o}=s;return function(t,n,e,s,i,a){if(p(t,n))return null;const r=new b(0,0),o=new b(e,s),l=x(r,o);if(i){if(a){const e=m(w(t,n),l);return Array.isArray(e)?e:null}{const e=y(n,t,l);return e&&!p(n,e)?g(n,e):null}}if(a){const e=y(t,n,l);return e&&!p(t,e)?g(t,e):null}{const e=_(g(t,n),l);return Array.isArray(e)?e:null}}(new b(t),new b(n),i,a,!!r,!!o)}_drawEnds(t,n,e,s){const[i,a]=n,r=h(this._data);if(r.leftEnd===f.Arrow)L(a,i,t,e,s);if(r.rightEnd===f.Arrow)L(i,a,t,e,s)}}function L(t,n,e,s,i,a=!1){if(v(t,n)<1)return;const r=function(t,n,e,s,i){const a=.5*e,r=Math.sqrt(2),o=n.subtract(t),l=o.normalized();let d=5*e;s&&(d=Math.min(d,.35*o.length()));const c=1*a;if(d*r*.2<=c)return[];const u=l.scaled(d),h=n.subtract(u),b=l.transposed(),f=b.scaled(d),p=h.add(f),x=h.subtract(f),m=p.subtract(n).normalized().scaled(c),w=x.subtract(n).normalized().scaled(c),y=i?n:n.add(m),g=i?n:n.add(w),_=a*(r-1),v=b.scaled(_),A=Math.min(d-a/r,a*r),L=l.scaled(A),z=n.subtract(v),E=n.add(v),M=n.subtract(L),P=M.subtract(v),S=M.add(v);return[[p,y],[g,x],[z,P],[E,S]]}(new b(t),new b(n),s,a,!0).slice(0,2);let o=null;const{horizontalPixelRatio:l,verticalPixelRatio:d}=i;for(let c=0;c<r.length;++c){const t=r[c][0],n=r[c][1];(null===o||v(o,t)>1)&&e.moveTo(t.x*l,t.y*d),e.lineTo(n.x*l,n.y*d),o=n}}export{A as L,L as d};
