var e=Object.defineProperty,t=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);import{e as n,u as r,bH as i}from"./index-5gyre0hA.js";import{H as o,V as l,a as c,d,g as s}from"./text-BhorOBkg.js";import{C as a}from"./composite-CCMtJLBO.js";import{F as h}from"./paneView-MhvZ7TYs.js";function f(e,t,r,i,o){if(o)return Math.round(n(e.coordinate)+n(t.coordinate)*r);{const o=n(e.price)+n(t.price)*r;return n(i.priceToCoordinate(o))}}function x(e,t,r,i,o){if(o){const o=n(e.coordinate)+n(t.coordinate)*r;return n(i.coordinateToPrice(o))}return n(e.price)+n(t.price)*r}const u=[o.Center,l.Middle];function g(e){return{renderer:e,point:n(e.point()),rect:e.rect(),horzAlign:n(e.data().horzAlign)}}function p(e,t){const n=e.rect.x-t.rect.width-m;t.renderer.setPoint(new r(n+t.rect.width/2,t.point.y))}function A(e,t){const n=e.rect.x+e.rect.width+m;t.renderer.setPoint(new r(n+t.rect.width/2,t.point.y))}function w(e,t){return null!==t&&e.rect.width>t}function b(e){return{left:0,center:1,right:2}[e]}const m=4;function T(e){const{leftAnchorX:t,rightAnchorX:n,extendLeft:r,extendRight:i,screenWidth:o,labelRenderer:l,horzLabelsAlign:c,labelAndTextHaveSameVertAlign:d}=e,s=d?function(e,t){if(!e)return 0;const n=v(e.x,0,t),r=v(e.x+e.width,0,t);return r-n}(null==l?void 0:l.rect(),o):0;let a=0;return r||i?r&&i?a=o-s:r?a=n-("left"===c?s:0):i&&(a=o-t-("right"===c?s:0)):a=n-t-("center"===c?s:0),a-8}function v(e,t,n){return Math.max(t,Math.min(n,e))}function L(e){const{labelAndTextHaveSameAlign:t,labelAndTextHaveSameVertAlign:i,labelRenderer:o,textRenderer:l,horzTextAlign:c,horzLabelsAlign:d,textMaxWidth:s,extendLeft:a=!1,extendRight:h=!1}=e;if(t){const e=g(o),t=g(l);switch(c){case"left":a?A(e,t):p(e,t);break;case"center":if(w(t,s))return{hideText:!0};!function(e,t){const n=e.rect.x+(e.rect.width+t.rect.width)/2,i=n-e.rect.width/2,o=n+e.rect.width/2;e&&e.renderer.setPoint(new r(i+e.rect.width/2,e.point.y)),t&&t.renderer.setPoint(new r(o+t.rect.width/2,t.point.y))}(e,t);break;case"right":h?p(e,t):A(e,t)}return{hideText:!1}}if(null!==s&&w(g(l),s))return{hideText:!0};if(i){const e=o.rect(),t=l.rect(),i=n(l.point());if(b(c)<b(d)){const n=t.x+t.width+m-e.x;n>0&&l.setPoint(new r(i.x-n,i.y))}else{const n=e.x+e.width+m-t.x;n>0&&l.setPoint(new r(i.x+n,i.y))}}return{hideText:!1}}function R(e){if(!e)return;const t=n(e.data()),i=t.vertAlign;if(i!==l.Middle){const o=n(t.points)[0],s=(i===l.Top?1:-1)*(c(t)+d(t));e.setData({...t,vertAlign:l.Middle,points:[new r({x:o.x,y:o.y+s})]})}}function y(e,t,n,r){if(null!==e&&t===l.Middle){const t=s(e,n,r);if(t)return[t]}return[]}class S extends h{constructor(){super(...arguments),t(this,"_renderer",new a(this._hitTestCollector))}renderer(){return this._renderer}_addLevels(e){const{mediaSize:t,levels:o,left:l,right:c,showText:d,labelAlign:s,textAlign:a,extendLeft:h,extendRight:f,isOnScreen:x,trendLineRenderer:g}=e;let p=l,A=c;p===A&&(h&&p--,f&&A++);const{width:w,height:b}=t,m=[],v=[];this._model.isSelected(this._source);const[S,z]=s;for(const _ of o){const e=_.y,t=new r(p,e),o=new r(A,e),l=!!_.text,c=_.index,s=!1,g=!l&&!0,[P,M]=g?u:a,H=S===P,O={levelIndex:c,coeff:_.coeff,leftPoint:t,rightPoint:o,color:_.color,extendLeft:h,extendRight:f};let V=null;const j=d&&(l||!1||s),C=j&&!l&&!0;j&&(V=n(this.getTextRenderer(c)),this._updateRendererLabel({...O,horzAlign:P,vertAlign:M,color:_.color},V,_.text||"Text"));const W=this._updateLabelForLevel({...O,price:_.price,horzAlign:S,vertAlign:z});let X=!1;if(V&&W){const e=z===M;X=L({labelRenderer:W,textRenderer:V,labelAndTextHaveSameAlign:H,labelAndTextHaveSameVertAlign:e,horzTextAlign:P,horzLabelsAlign:S,textMaxWidth:C?T({leftAnchorX:p,rightAnchorX:A,extendLeft:h,extendRight:f,screenWidth:w,horzLabelsAlign:S,labelRenderer:W,labelAndTextHaveSameVertAlign:e}):null,extendLeft:h,extendRight:f}).hideText}if(x){R(V),R(W);if(!(!h&&!f&&(V&&"center"===P&&"middle"===M&&A-4<V.rect().x+V.rect().width||W&&"center"===S&&"middle"===z&&p+4>W.rect().x))){const e=[...y(W,z,w,b),...y(X?null:V,M,w,b)],n=this.getLevelLineRenderer(c);n.setData({points:[t,o],lineColor:_.color,lineWidth:_.linewidth,lineStyle:_.linestyle,extendLeft:h,extendRight:f,leftEnd:i.Normal,rightEnd:i.Normal,excludeBoundaries:e,hitTestTolerance:4}),m.push(n)}}W&&!W.isOutOfScreen(w,b)&&v.push(W),X||!V||V.isOutOfScreen(w,b)||v.push(V)}for(const n of m)this._renderer.append(n);g&&this._renderer.append(g);for(const n of v)this._renderer.append(n)}}export{S as F,x as a,f};
