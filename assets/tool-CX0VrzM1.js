var e=Object.defineProperty,t=(t,i,n)=>((t,i,n)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n)(t,"symbol"!=typeof i?i+"":i,n);import{A as i,bH as n,y as s,z as r,L as l}from"./index-5gyre0hA.js";import{T as a,a as o,D as d}from"./toolPaneView-BkZhzbTB.js";import{E as c}from"./index-iNH1zFVl.js";import{P as h}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as p}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as m,T as u}from"./axisPaneView-B6qY_qE1.js";import{C as w}from"./channel-Q-8H9X-L.js";import{C as f}from"./composite-CCMtJLBO.js";import{L as x}from"./line-BKuOqRrm.js";import"./baseTool-BM5mqL4_.js";class _ extends a{constructor(){super(...arguments),t(this,"_medianRenderer",new x),t(this,"_sideRenderer",new x),t(this,"_renderer",new f(this._hitTestCollector))}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this.points();if((null==e?void 0:e.length)<2)return;const[t]=e,l=new i(3===e.length?e[1].add(e[2]).scaled(.5):2===e.length?e[1]:t,{pointIndex:3}),a=this._source.properties(),o=a.median,d={points:[t,l.point],lineColor:o.color,lineWidth:o.linewidth,lineStyle:o.linestyle,extendLeft:!1,extendRight:!0,leftEnd:n.Normal,rightEnd:n.Normal};if(this._medianRenderer.setData(d),this._renderer.append(this._medianRenderer),e.length<3)return void this.addAnchors(this._renderer);const c={points:[e[1],e[2]],lineColor:o.color,lineWidth:o.linewidth,lineStyle:o.linestyle,extendLeft:!1,extendRight:!1,leftEnd:n.Normal,rightEnd:n.Normal};this._sideRenderer.setData(c),this._renderer.append(this._sideRenderer);const h=e[2].subtract(e[1]).scaled(.5),p=a.fillBackground,m=a.transparency;let u=0;a.levels.forEach((e=>{const i=e.coeff,o=e.color,d=l.point.addScaled(h,i),c=l.point.addScaled(h,-i);if(p){const e=new w;e.setData({p1:t,p2:d,p3:t,p4:l.point.addScaled(h,u),color:o,transparency:m,hittestOnBackground:!0,extendLeft:!1}),this._renderer.append(e);const i=new w;i.setData({p1:t,p2:c,p3:t,p4:l.point.addScaled(h,-u),color:o,transparency:m,hittestOnBackground:!0,extendLeft:!1}),this._renderer.append(i)}u=i;const f=new x;f.setData({points:[t,d],lineColor:o,lineWidth:a.levelsStyle.linewidth,lineStyle:a.levelsStyle.linestyle,extendLeft:!1,extendRight:!0,leftEnd:n.Normal,rightEnd:n.Normal}),f.setHitTest(new s(r.MovePoint)),this._renderer.append(f);const _=new x;_.setData({points:[t,c],lineColor:o,lineWidth:a.levelsStyle.linewidth,lineStyle:a.levelsStyle.linestyle,extendLeft:!1,extendRight:!0,leftEnd:n.Normal,rightEnd:n.Normal}),_.setHitTest(new s(r.MovePoint)),this._renderer.append(_)})),this.addAnchors(this._renderer)}}class y extends o{constructor(){super(...arguments),t(this,"_lines",new _(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new m(Object.create(null))]),t(this,"_timeAxisPaneViews",[new u(Object.create(null))]),t(this,"_timeAxisViews",[new p(Object.create(null)),new p(Object.create(null)),new p(Object.create(null))]),t(this,"_priceAxisViews",[new h(Object.create(null)),new h(Object.create(null)),new h(Object.create(null))])}pointsCount(){return 3}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let s=0;s<this.controlPoints.length;s++){const t=this.controlPoints[s],n=this.pointToScreenPoint(t);if(!n)return;e.push(new i(n,{pointIndex:s}))}const t=e.map((e=>e.x)),n=e.map((e=>e.y));this.controlPoints.forEach(((t,i)=>{this._timeAxisViews[i].update(this._calculateTimeAxisViewData(t.time,e[i].x)),this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,e[i].y))})),t.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,t),Math.max.apply(null,t))),n.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,n),Math.max.apply(null,n))),this._lines.update({points:e})}}class g extends d{constructor(){super(...arguments),t(this,"type",c)}createPrimitive(){return new y({id:this.id,points:[],fillBackground:!0,transparency:80,levelsStyle:{linewidth:2,linestyle:l.solid},levels:[{coeff:.5,color:"#00BCD4"},{coeff:1,color:"#2962FF"}],median:{visible:!0,color:"#F23645",linewidth:2,linestyle:l.solid}},...this.resetArgs)}}export{g as PitchfanTool};
