var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{B as i,g as s,n as r,V as n,H as o}from"./text-BhorOBkg.js";import{T as a,a as l,D as h}from"./toolPaneView-BkZhzbTB.js";import{V as d}from"./index-iNH1zFVl.js";import{P as c}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{u as p,r as u,y as _,z as x,B as w,L as b,aZ as f,bI as m,cl as y,bK as g,A as P}from"./index-5gyre0hA.js";import{C as A}from"./composite-CCMtJLBO.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";import"./baseTool-BM5mqL4_.js";class R extends w{hitTest(e){if(null===this._data||0===this._data.points.length)return null;const t=this._data.points[0];if(e.x<t.x)return null;const i=g().line;return Math.abs(e.y-t.y)<=i?this._hitTest:null}drawImpl(e){if(null===this._data||0===this._data.points.length)return;const{context:t,horizontalPixelRatio:i,verticalPixelRatio:s,bitmapSize:r}=e,n=r.width,o=this._data.points[0],a=o.y,l=Math.max(0,o.x),h=Math.max(n,o.x),d=void 0===this._data.linestyle||this._data.linestyle===b.solid;t.lineCap=d?"round":"butt",t.strokeStyle=this._data.color,t.lineWidth=Math.max(1,Math.floor(this._data.linewidth*i)),void 0!==this._data.linestyle&&f(t,this._data.linestyle),void 0!==this._data.excludeBoundaries&&m(e,this._data.excludeBoundaries),y(t,Math.round(a*s),Math.round(l*i),Math.round(h*i))}}class v extends a{constructor(){super(...arguments),t(this,"_horzRayRenderer",new R),t(this,"_labelRenderer",new i),t(this,"_renderer",new A(this._hitTestCollector))}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this.points();if(0===(null==e?void 0:e.length))return;const t=this._source.properties();let i,r=e[0].clone();if(t.showLabel&&1===e.length){const e=t.vertLabelsAlign,n=t.horzLabelsAlign,o=0;let a=0;const l=t.text,h=t.bold,d=t.italic,c=t.fontSize,{mediaSize:_}=this._source.getScope(),x=_.width;if("right"===n){const e=this._labelRenderer.measure().width;r.x+e+3>=x?r=r.add(new p(e+3,0)):(r=new p(x,r.y),a=3)}else"center"===n&&(r=new p((r.x+x)/2,r.y));const w={points:[r],text:l,color:t.textColor,vertAlign:e,horzAlign:n,fontFamily:u,offsetX:a,offsetY:o,bold:h,italic:d,fontSize:c,forceTextAlign:!0};if(this._labelRenderer.setData(w),this._renderer.append(this._labelRenderer),this._needLabelExclusionPath(this._labelRenderer)){const{width:e,height:t}=_;i=s(this._labelRenderer,e,t)??void 0}}const n={points:e,color:t.linecolor,linewidth:t.linewidth,linestyle:t.linestyle,excludeBoundaries:i};this._horzRayRenderer.setData(n),this._horzRayRenderer.setHitTest(new _(x.MovePoint,{snappingPrice:this._source.controlPoints[0].price})),this._renderer.append(this._horzRayRenderer),this.addAnchors(this._renderer)}_needLabelExclusionPath(e,t){const i=this._source.properties();return"middle"===(t??i.vertLabelsAlign)&&r(e)}}class z extends l{constructor(){super(...arguments),t(this,"_line",new v(this,this.model)),t(this,"_paneView",[this._line]),t(this,"_priceAxisViews",[new c(Object.create(null))])}pointsCount(){return 1}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let t=0;t<this.controlPoints.length;t++){const i=this.controlPoints[t],s=this.pointToScreenPoint(i);if(!s)return;e.push(new P(s,{pointIndex:t}))}this.controlPoints.forEach(((t,i)=>{this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,e[i].y))})),this._paneView[0].update({points:e})}}class j extends h{constructor(){super(...arguments),t(this,"type",d)}createPrimitive(){return new z({id:this.id,points:[],linecolor:"#2962FF",linewidth:2,linestyle:0,showPrice:!0,showLabel:!1,textColor:"#2962FF",fontSize:12,bold:!1,italic:!1,text:"",horzLabelsAlign:o.Center,vertLabelsAlign:n.Top},...this.resetArgs)}}export{j as HorizontalRayTool};
