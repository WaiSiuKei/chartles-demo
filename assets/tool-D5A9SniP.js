var e=Object.defineProperty,i=(i,t,s)=>((i,t,s)=>t in i?e(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s)(i,"symbol"!=typeof t?t+"":t,s);import{V as t,H as s}from"./text-BhorOBkg.js";import{u as r,bH as l,A as o,e as n,L as a}from"./index-5gyre0hA.js";import{a as c,D as h}from"./toolPaneView-BkZhzbTB.js";import{t as p}from"./index-iNH1zFVl.js";import{P as d}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as f}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as m,T as x}from"./axisPaneView-B6qY_qE1.js";import{F as u,f as w,a as b}from"./horizontalLevelsPaneView-DeGMu8P0.js";import{L as v}from"./line-BKuOqRrm.js";import{R as A}from"./rectangle-E0x1RaIQ.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";import"./baseTool-BM5mqL4_.js";import"./composite-CCMtJLBO.js";import"./paneView-MhvZ7TYs.js";import"./formatter-BMswhHnL.js";import"./numericFormatter-DcPXx81O.js";class _ extends u{constructor(){super(...arguments),i(this,"_trendLineRenderer",new v)}_updateImpl(){this._renderer.clear();const e=this.points();if((null==e?void 0:e.length)<2)return;const i=this._source.properties(),t=e[0],s=e[1],o=Math.min(t.x,s.x),n=Math.max(t.x,s.x),a=i.fillBackground,c=i.transparency,h=i.extendLinesLeft,p=i.extendLines,d=this._source.getScope(),{width:f}=d.mediaSize,m=!(o>f&&!h||n<0&&!p),x=i.levels.reduce(((e,t,s)=>(e.push({color:t.color,coeff:t.coeff,y:this._data.levels[s].y,price:this._data.levels[s].price,linewidth:i.levelsStyle.linewidth,linestyle:i.levelsStyle.linestyle,index:s}),e)),[]);if(a&&m)for(let l=1;l<x.length;l++){const e=x[l],i=x[l-1],t=new A;t.setData({points:[new r(o,e.y),new r(n,i.y)],color:e.color,lineWidth:0,backColor:e.color,transparency:c,extendLeft:h,extendRight:p}),this._renderer.append(t)}let u=o,w=n;u===w&&(h&&(u-=1),p&&(w+=1));const b=i.trendline;let v=null;b.visible&&m&&(v=this._trendLineRenderer,v.setData({points:[t,s],lineColor:b.color,lineWidth:b.linewidth,lineStyle:b.linestyle,extendLeft:!1,extendRight:!1,leftEnd:l.Normal,rightEnd:l.Normal})),this._addLevels({mediaSize:d.mediaSize,levels:x,left:u,right:w,showLabel:i.showCoeffs||i.showPrices,showText:i.showText,labelAlign:[i.horzLabelsAlign,i.vertLabelsAlign],textAlign:[i.horzTextAlign,i.vertTextAlign],extendLeft:h,extendRight:p,fontSize:i.labelFontSize,isOnScreen:m,trendLineRenderer:v}),this.addAnchors(this._renderer)}}class g extends c{constructor(){super(...arguments),i(this,"_lines",new _(this,this.model)),i(this,"_paneView",[this._lines]),i(this,"_priceAxisPaneViews",[new m(Object.create(null))]),i(this,"_timeAxisPaneViews",[new x(Object.create(null))]),i(this,"_timeAxisViews",[new f(Object.create(null)),new f(Object.create(null))]),i(this,"_priceAxisViews",[new d(Object.create(null)),new d(Object.create(null))])}pointsCount(){return 2}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let n=0;n<this.controlPoints.length;n++){const i=this.controlPoints[n],t=this.pointToScreenPoint(i);if(!t)return;e.push(new o(t,{pointIndex:n}))}const i=e.map((e=>e.x)),t=e.map((e=>e.y));this.controlPoints.forEach(((i,t)=>{this._timeAxisViews[t].update(this._calculateTimeAxisViewData(i.time,e[t].x)),this._priceAxisViews[t].update(this._calculatePriceAxisViewData(i.price,e[t].y))})),i.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,i),Math.max.apply(null,i))),t.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,t),Math.max.apply(null,t)));const[s,r]=this.controlPoints,l=this._props.reverse,a=l?s.price:r.price,c=l?r.price:s.price,h=c-a,p=n(this.series.priceToCoordinate(a)),d={price:a,coordinate:p},f={price:h,coordinate:n(this.series.priceToCoordinate(c))-p},m=!1,x=this._props.levels.reduce(((e,i,t)=>{if(!i.visible)return e;const s=i.coeff,r=w(d,f,s,this.series,m),l=b(d,f,s,this.series,m);return e.push({y:r,price:this.series.priceFormatter().format(l),index:t}),e}),[]);this._lines.update({points:e,levels:x})}}class y extends h{constructor(){super(...arguments),i(this,"type",p)}createPrimitive(){return new g({id:this.id,points:[],showCoeffs:!0,showPrices:!0,fillBackground:!0,transparency:80,extendLines:!1,extendLinesLeft:!1,horzLabelsAlign:s.Left,vertLabelsAlign:t.Middle,showText:!0,horzTextAlign:s.Center,vertTextAlign:t.Middle,reverse:!1,coeffsAsPercents:!1,fibLevelsBasedOnLogScale:!1,labelFontSize:12,trendline:{visible:!0,color:"#808080",linewidth:2,linestyle:a.dashed},levelsStyle:{linewidth:2,linestyle:a.solid},levels:[{coeff:0,color:"#808080",visible:!0},{coeff:.236,color:"#F23645",visible:!0},{coeff:.382,color:"#FF9800",visible:!0},{coeff:.5,color:"#4CAF50",visible:!0},{coeff:.618,color:"#089981",visible:!0},{coeff:.786,color:"#00BCD4",visible:!0},{coeff:1,color:"#808080",visible:!0},{coeff:1.618,color:"#2962FF",visible:!0},{coeff:2.618,color:"#F23645",visible:!0},{coeff:3.618,color:"#9C27B0",visible:!0},{coeff:4.236,color:"#E91E63",visible:!0}]},...this.resetArgs)}}export{y as FibRetracementTool};
