var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{P as i}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as s}from"./timeLabelTimeAxisView-DLVMuesT.js";import{L as r,cj as n,ch as l,y as o,z as c,cw as a,M as h,r as d,B as p,u,v as w,A as b}from"./index-5gyre0hA.js";import{P as m,T as x}from"./axisPaneView-B6qY_qE1.js";import{T as f,a as _}from"./toolPaneView-BkZhzbTB.js";import{d as j}from"./ctx-BQtFq0AI.js";import{m as y}from"./font-DVjjKW8j.js";import{C as g}from"./composite-CCMtJLBO.js";import{P as A}from"./polygon-D49cV0Ps.js";class P extends p{constructor(e,i){super(e),t(this,"_hitTestResult"),this._hitTestResult=i}hitTest(e){const t=this._getCenter(),i=this.data().circleRadius,s={min:new u(t.x-i,t.y-i),max:new u(t.x+i,t.y+i)};return w(e,s)?this._hitTestResult:null}drawImpl(e){const t=e.context,{horizontalPixelRatio:i,verticalPixelRatio:s}=e,r=Math.max(1,Math.floor(i))%2/2,n=this._getCenter(),l=Math.round(n.x*i)+r,o=Math.round(n.y*s)+r,c=this.data();if(c.showCircle){const e=Math.round(l+c.circleRadius*i)-l-c.circleBorderWidth*i/2;t.strokeStyle=c.color,t.lineWidth=c.circleBorderWidth*i,t.beginPath(),t.moveTo(l+e,o),t.arc(l,o,e,0,2*Math.PI),t.stroke()}t.font=y(c.fontSize,c.font,c.bold?"bold":void 0),t.textBaseline="middle",t.textAlign="center",t.fillStyle=c.color,j(t,i,s,(()=>{const e=.05*c.fontSize;t.fillText(c.letter,l/i,o/s+e)})),t.restore()}_getCenter(){const e=this.data(),t="bottom"===e.vertAlign?-1:1,i=e.point.y+t*(e.yOffset+e.circleRadius),s=e.point.x;return new u(s,i)}}const O={4:{font:24,circle:36,circleBorderWidth:1,bold:!0},3:{font:20,circle:28,circleBorderWidth:1,bold:!1},2:{font:18,circle:22,circleBorderWidth:1,bold:!1},1:{font:16,circle:22,circleBorderWidth:1,bold:!1},0:{font:11,circle:14,circleBorderWidth:1,bold:!0}};class V extends f{constructor(){super(...arguments),t(this,"_renderer",new g(this._hitTestCollector)),t(this,"_polylineRenderer",new A)}renderer(){return this._renderer}_updateImpl(){this.renderer().clear();const e=this._source.properties();if(e.showWave){const t={points:this.points(),lineColor:e.color,lineWidth:e.lineWidth,lineStyle:r.solid,filled:!1,background:"rgba(0, 0, 0, 0)",lineJoin:"round"};this._polylineRenderer.setData(t),this._renderer.append(this._polylineRenderer)}const t=this.areAnchorsVisible()?0:1;let i=1;if(this.points().length>2){const e=this.points()[2],t=this.points()[1];i=n(e.y-t.y)}let s=0;this._model.currentCreating===this._source&&(s=1);const p=l(e.color);for(let r=0;r<this.points().length-s;r++,i=-i){if(r<t)continue;const e=this._data.labels[r];let s=e.label;"circle"===e.decoration||"brackets"===e.decoration&&(s="("+s+")");const n=O[e.group],l=new o(c.ChangePoint,{areaName:h.AnchorPoint,componentIndex:r,resizeDirections:a});this._renderer.append(new P({point:this.points()[r],letter:s,color:p,font:d,fontSize:n.font,bold:n.bold,showCircle:"circle"===e.decoration,circleRadius:n.circle/2,circleBorderWidth:n.circleBorderWidth,yOffset:10,vertAlign:1===i?"top":"bottom"},l))}const u=this.points().slice();this._model.currentCreating===this._source&&u.pop(),this._renderer.append(this.createLineAnchor({points:u},0))}}const W=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14];class T extends _{constructor(){super(...arguments),t(this,"_lines",new V(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new m(Object.create(null))]),t(this,"_timeAxisPaneViews",[new x(Object.create(null))]),t(this,"_timeAxisViews",[]),t(this,"_priceAxisViews",[])}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let r=0;r<this.controlPoints.length;r++){const t=this.controlPoints[r],i=this.pointToScreenPoint(t);if(!i)return;e.push(new b(i,{pointIndex:r}))}const t={points:e,labels:[]},i=e.map((e=>e.x)),s=e.map((e=>e.y));this.controlPoints.forEach(((i,s)=>{this._timeAxisViews[s].update(this._calculateTimeAxisViewData(i.time,e[s].x)),this._priceAxisViews[s].update(this._calculatePriceAxisViewData(i.price,e[s].y)),t.labels[s]=this.getLabelStyle(s)})),i.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,i),Math.max.apply(null,i))),s.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,s),Math.max.apply(null,s))),this._lines.update(t)}getLabelStyle(e){const t=this.properties().degree,i=W.length-t-1,s=Math.floor(i/3),r=this.labelsGroup()[s][e];return{group:s,bold:s%2!=0,decoration:["","brackets","circle"][i%3],label:r}}}class C extends T{constructor(){super(...arguments),t(this,"_timeAxisViews",[new s(Object.create(null)),new s(Object.create(null)),new s(Object.create(null)),new s(Object.create(null))]),t(this,"_priceAxisViews",[new i(Object.create(null)),new i(Object.create(null)),new i(Object.create(null)),new i(Object.create(null))])}pointsCount(){return 4}}class M extends T{constructor(){super(...arguments),t(this,"_timeAxisViews",[new s(Object.create(null)),new s(Object.create(null)),new s(Object.create(null)),new s(Object.create(null)),new s(Object.create(null)),new s(Object.create(null))]),t(this,"_priceAxisViews",[new i(Object.create(null)),new i(Object.create(null)),new i(Object.create(null)),new i(Object.create(null)),new i(Object.create(null)),new i(Object.create(null))])}pointsCount(){return 6}}export{M as W,C as a};
