var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{y as i,z as s,e as n,u as r,bU as o,r as a,w as l,bM as h,v as c,bR as d,bQ as w,bV as p,A as m,bH as g}from"./index-5gyre0hA.js";import{g as u,n as x,V as P,H as _}from"./text-BhorOBkg.js";import{g as b}from"./toolPaneView-BkZhzbTB.js";import{T as f,S as R}from"./TrendToolWithStatsPaneView-BX4ipabS.js";import{B as A,a as T}from"./textPaneView-LQytaZVw.js";import{T as j}from"./index-iNH1zFVl.js";import{P as y}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as S}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as V,T as D}from"./axisPaneView-B6qY_qE1.js";import{P as v}from"./PlusTextRendererDecorator-h8tsWFCo.js";import{L}from"./line-BKuOqRrm.js";import{T as E}from"./renderer-CaYvdS1S.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";import"./baseTool-BM5mqL4_.js";import"./font-DVjjKW8j.js";import"./formatter-BMswhHnL.js";import"./numericFormatter-DcPXx81O.js";import"./composite-CCMtJLBO.js";import"./svg-D8gy4lKT.js";class M extends f{constructor(){super(...arguments),t(this,"_trendRenderer",new L(void 0,void 0,new i(s.MovePoint))),t(this,"_labelRenderer",new E(new i(s.MovePoint)))}_getPointsForStats(){return[this.points()[0],n(this._middlePoint),this.points()[1]]}_updateImpl(){this._renderer.clear();const e=this.points();if((null==e?void 0:e.length)<2)return;const t=this._source.properties();t.showPriceRange||t.showPercentPriceRange||t.showPipsPriceRange||t.showBarsRange||t.showDateTimeRange||t.showDistance||t.showAngle||(this._label=null,this._labelData&&(this._labelData.text=""));const i=e[0],n=e[1];this._middlePoint=new r(o(i,n));const g=this._source.getScope(),{mediaSize:{width:x,height:P}}=g;let _;const b=t.text,f=this._isTextEditMode(),A=this._placeHolderMode(!0);if(t.showLabel&&(b||A||f)){const e=i.x<n.x?i:n,s=e===i?n:i,o=t.vertLabelsAlign,l=t.horzLabelsAlign;let h;h="left"===l?e.clone():"right"===l?s.clone():new r((i.x+n.x)/2,(i.y+n.y)/2);const c=Math.atan((s.y-e.y)/(s.x-e.x));this._labelRenderer.setData({points:[h],text:this._textDisplay(),color:this._textDisplayColor(),vertAlign:o,horzAlign:l,fontFamily:a,offsetX:0,offsetY:0,bold:t.bold,italic:t.italic,fontSize:t.fontSize,forceTextAlign:!0,angle:c,decorator:A?v.instance():void 0}),this._labelRenderer.setCursorType(this._textCursorType()),this._renderer.append(this._labelRenderer),this._needLabelExclusionPath(this._labelRenderer)&&(_=u(this._labelRenderer,x,P)??void 0),this._labelRenderer.isOutOfScreen(x,P)?this.closeTextEditor():this._updateEditor(this._labelRenderer.getTextInfo())}const T=t.linecolor,j={points:e,lineColor:T,lineWidth:t.linewidth,lineStyle:t.linestyle,extendLeft:t.extendLeft,extendRight:t.extendRight,leftEnd:t.leftEnd,rightEnd:t.rightEnd,excludeBoundaries:_?[_]:void 0};this._trendRenderer.setData(j),this._renderer.insert(this._trendRenderer,0);const y=l(new r(0,0),new r(x,P));let S=!1;if(t.statsPosition===R.Auto)if(h(i,n))S=!c(i,y);else{S=null===d(w(i,n),y)}if(((this.isHoveredSource()||this.isSelectedSource())&&this._isTextEditMode()||t.alwaysShowStats)&&(S||2!==e.length||this._renderer.append(this._updateAndReturnStatsRenderer(g))),this._middlePoint&&!f){const e=(this.isHoveredSource()||this.isSelectedSource())&&t.showMiddlePoint;this._renderer.append(new p({points:[new m(this._middlePoint)],bgColors:this._lineAnchorColors([this._middlePoint]),color:T,visible:e&&this.areAnchorsVisible(),hitTarget:s.Regular}))}this.addAnchors(this._renderer)}_needLabelExclusionPath(e,t){const i=this._source.properties();return"middle"===(t??i.vertLabelsAlign)&&x(e)}}class C extends A{constructor(){super(...arguments),t(this,"_line",new M(this,this.model,this.editingHelper)),t(this,"_priceAxisPaneViews",[new V(Object.create(null))]),t(this,"_timeAxisPaneViews",[new D(Object.create(null))]),t(this,"_timeAxisViews",[new S(Object.create(null)),new S(Object.create(null))]),t(this,"_priceAxisViews",[new y(Object.create(null)),new y(Object.create(null))]),t(this,"_paneView",[this._line])}pointsCount(){return 2}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let s=0;s<this.controlPoints.length;s++){const t=this.controlPoints[s],i=this.pointToScreenPoint(t);if(!i)return;e.push(new m(i,{pointIndex:s}))}const t=e.map((e=>e.x)),i=e.map((e=>e.y));this.controlPoints.forEach(((t,i)=>{this._timeAxisViews[i].update(this._calculateTimeAxisViewData(t.time,e[i].x)),this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,e[i].y))})),t.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,t),Math.max.apply(null,t))),i.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,i),Math.max.apply(null,i))),this._paneView[0].update({points:e})}isCreationFinished(){return this._line.isCreationFinished()}startTextEditing(){return this._line.startTextEditing()}}class F extends T{constructor(){super(...arguments),t(this,"type",j),t(this,"extendLeft",!1),t(this,"extendRight",!1),t(this,"showPriceLabels",!1),t(this,"showPriceRange",!1),t(this,"showPercentPriceRange",!1),t(this,"showPipsPriceRange",!1),t(this,"showDateTimeRange",!1),t(this,"showBarsRange",!1),t(this,"showDistance",!1),t(this,"showAngle",!1),t(this,"alwaysShowStats",!1),t(this,"rightEnd",g.Normal)}createPrimitive(e){const t=b(e);return new C({id:this.id,points:[],linecolor:"#2962FF",linewidth:2,linestyle:0,extendLeft:this.extendLeft,extendRight:this.extendRight,leftEnd:0,rightEnd:this.rightEnd,showLabel:!1,horzLabelsAlign:_.Center,vertLabelsAlign:P.Bottom,textColor:"#2962FF",fontSize:14,text:"",placeholder:"",wordWrap:!0,bold:!1,italic:!1,alwaysShowStats:this.alwaysShowStats,showMiddlePoint:!1,showPriceLabels:this.showPriceLabels,showPriceRange:this.showPriceRange,showPercentPriceRange:this.showPercentPriceRange,showPipsPriceRange:this.showPipsPriceRange,showBarsRange:this.showBarsRange,showDateTimeRange:this.showDateTimeRange,showDistance:this.showDistance,showAngle:this.showAngle,statsPosition:R.Right,formatBarCount:e=>t.t("tool.line.common.bars",e),formatDistance:e=>t.t("tool.line.common.distance",e)},...this.getTextResetArgs(e))}finishDrawing(){n(this._drawingSession).finishDrawing()}}export{F as TrendLineTool};
