var e=Object.defineProperty,t=(t,i,r)=>((t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r)(t,"symbol"!=typeof i?i+"":i,r);import{bV as i,z as r,bD as s,aY as o,y as n,A as a,aP as l}from"./index-5gyre0hA.js";import{T as h,a as c,D as p}from"./toolPaneView-BkZhzbTB.js";import{P as u}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as d}from"./timeLabelTimeAxisView-DLVMuesT.js";import{C as b}from"./composite-CCMtJLBO.js";import"./baseTool-BM5mqL4_.js";class _ extends s{drawImpl(e){if(!this._data)return;const t=e.context,i=Math.round(this._data.point.x)-.5,r=Math.round(this._data.point.y-22)-.5;t.translate(i,r),t.fillStyle="#434651",o(t,0,0,2,22,1),t.fill(),t.fillStyle=this._data.color,t.beginPath(),t.moveTo(6.87,0),t.bezierCurveTo(5.62,0,4.46,.23,3.32,.69),t.bezierCurveTo(3.26,.71,3.2,.75,3.15,.8),t.bezierCurveTo(3.06,.89,3,1.02,3,1.16),t.lineTo(3,1.19),t.lineTo(3,12.5),t.bezierCurveTo(3,12.8,3.3,13.02,3.59,12.93),t.bezierCurveTo(4.61,12.64,5.94,12.44,6.87,12.44),t.bezierCurveTo(8.5,12.44,10.09,12.83,11.63,13.21),t.bezierCurveTo(13.19,13.6,14.79,14,16.45,14),t.bezierCurveTo(17.59,14,18.65,13.81,19.69,13.43),t.bezierCurveTo(19.88,13.36,20,13.18,20,12.98),t.lineTo(20,1.19),t.bezierCurveTo(20,1.06,19.83,.93,19.66,.99),t.bezierCurveTo(18.63,1.38,17.58,1.56,16.45,1.56),t.bezierCurveTo(14.82,1.56,13.23,1.17,11.69,.79),t.bezierCurveTo(10.14,.4,8.53,0,6.87,0),t.closePath(),t.fill()}hitTest(e){if(!this._data)return null;const{x:t,y:i}=this._data.point;return e.x>=t&&e.x<=t+20&&e.y>=i-22&&e.y<=i?new n(r.MovePoint):null}}class T extends h{constructor(){super(...arguments),t(this,"_renderer",new b(this._hitTestCollector)),t(this,"_flagMarkRenderer",new _)}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this._source.properties();this._flagMarkRenderer.setData({point:this.points()[0],color:e.color}),this._renderer.append(this._flagMarkRenderer),this._renderer.append(new i({points:this.points(),bgColors:this._lineAnchorColors(this.points()),visible:this.areAnchorsVisible(),hitTarget:r.MovePoint}))}}class m extends c{constructor(){super(...arguments),t(this,"_lines",new T(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_timeAxisViews",[new d(Object.create(null))]),t(this,"_priceAxisViews",[new u(Object.create(null))])}pointsCount(){return 1}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let t=0;t<this.controlPoints.length;t++){const i=this.controlPoints[t],s=this.pointToScreenPoint(i);if(!s)return;const o=new a(s,{pointIndex:t,hitTarget:r.ChangePoint});e.push(o),this._timeAxisViews[t].update(this._calculateTimeAxisViewData(i.time,s.x)),this._priceAxisViews[t].update(this._calculatePriceAxisViewData(i.price,s.y))}this._lines.update({points:e})}}class w extends p{constructor(){super(...arguments),t(this,"type",l)}createPrimitive(){return new m({id:this.id,points:[],color:"#2962FFFF"},...this.resetArgs)}}export{w as FlagMarkTool};
