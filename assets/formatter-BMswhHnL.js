var e=Object.defineProperty,t=(t,i,r)=>((t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r)(t,"symbol"!=typeof i?i+"":i,r);import{c0 as i,c1 as r,c2 as n,a as o,e as a,c3 as s}from"./index-5gyre0hA.js";import{f as c,g as l,B as m,a as h,p as u,N as p}from"./numericFormatter-DcPXx81O.js";import{f,a as v}from"./text-BFLAaZ9z.js";function _(e,t){if(!function(e){return"number"==typeof e||i(e)&&"[object Number]"==r(e)}(e))return"n/a";if(!n(t))throw new TypeError("Invalid length: must be integer");if(t<0||t>24)throw new TypeError("Invalid length: must be between 0 and 24");if(0===t)return e.toString();return("000000000000000000000000"+e.toString()).slice(-t)}function M(e){const t=new Map;return i=>{let r=t.get(i);return void 0!==r||(r=e(i),t.set(i,r)),r}}function g(e){const t=new m(e).toFixed().split(".")[1]||"",i=Math.pow(10,t.length);return{priceScale:i,minMove:new m(e).mul(i).toNumber()}}function d(e,t){var i,r;const n=[{minTick:o(e)?g(e):e,price:1/0,maxIndex:1/0}];try{const e=t.split(" ").map(((e,t)=>{if(s(t))return function(e){const t=Number(e);if(Number.isFinite(t))return g(t);const i=e.split("/");if(i.length<2||i.length>3)throw new Error(`Unexpected mintick: ${e}`);const[r,n,o]=i,a=Number(n),s=Number(r),c=void 0!==o?Number(o):void 0;if(!Number.isFinite(a)||!Number.isFinite(s))throw new Error(`Invalid fractional minTick: ${e}`);if(void 0!==o&&!Number.isFinite(c))throw new Error(`Invalid minMove2 in minTick: ${e}`);return{priceScale:a,minMove:s,...void 0!==c?{minMove2:c}:{}}}(e);{const t=Number(e);if(Number.isNaN(t))throw new Error(`Unexpected price limit: ${e}`);return t}}));if(s(e.length))throw new Error("Theme must not have even number of elements");const n=[];for(let t=0;t<e.length;t+=2){const o=e[t],a=e[t+1]??1/0,s=(null==(i=n[n.length-1])?void 0:i.price)??0,c=(null==(r=n[n.length-1])?void 0:r.maxIndex)??0,l=b(o),h=a===1/0?1/0:new m(a).minus(s).div(l).plus(c).toNumber();n.push({minTick:o,price:a,maxIndex:h})}return n}catch{return n}}function b(e){return"number"==typeof e?e:e.minMove/e.priceScale}class F{constructor(e){t(this,"_priceScale"),t(this,"_minMove"),t(this,"_minMove2"),t(this,"_ignoreMinMove"),t(this,"_fractionalLength"),t(this,"_variableMinTickData"),t(this,"_formatterErrors",{custom:"custom_format_error",fraction:"fraction_format_error",secondFraction:"secondary_fraction_error"});const{priceScale:i,minMove:r,minMove2:n,ignoreMinMove:o,variableMinTick:a,fractionalLength:s}=e;this._priceScale=i,this._minMove=r,this._minMove2=n,this._ignoreMinMove=o,this._fractionalLength=s,void 0!==a&&(this._variableMinTickData=d({priceScale:i,minMove:r,minMove2:n},a))}formatImpl(e,t={}){const{signPositive:i,signNegative:r=!0,tailSize:n,cutFractionalByPrecision:o=!1,useRtlFormat:a=!0,variableMinTickDataPrice:s,ignoreLocaleNumberFormat:c,removeAllEndingZeros:l}=t;let m="";e<0?m=!1===r?"":"−":0!==e&&!0===i&&(m="+");const h=Math.abs(e),u=this._formatUnsigned(h,n,o,s,c,l);return a?f(m+u):m+u}parse(e,t){let i=v(e);return i=i.replace("−","-"),i.startsWith("+")&&(i=i.substring(1)),this._parseUnsigned(i)}_removeEndingZeros(e,t){let i=e;for(let r=0;r<t&&i.endsWith("0");r++)i=i.slice(0,-1);return i}_formatUnsigned(e,t,i,r,n,o){let a=e.toFixed(2);return o&&(a=this._removeEndingZeros(a,5)),a}_parseUnsigned(e){return parseFloat(e)}hasForexAdditionalPrecision(){return!1}}function S(e,t,i,r){let n=0;if(e>0&&t>0){let t=e;for(i&&void 0!==r&&(t=e/r);t>1;)t/=10,n++}return n}function w(e,t,i){const r=a(function(e){const{minTick:t,price:i,variableMinTickData:r,shouldCheckForEquality:n}=e;return void 0===r?o(t)?g(t):t:function(e,t,i=!1){for(let r=0;r<t.length;r++){const n=t[r];if(e<n.price)return n.minTick;if(i&&e===n.price)return n.minTick}return t[t.length-1].minTick}(i,r,n)}({price:i,minTick:null,variableMinTickData:t,shouldCheckForEquality:!0})),{priceScale:n,minMove:s,minMove2:c}=r;return{priceScale:n,minMove:s,fractionalLength:S(n,s,e,c)}}class N extends F{constructor(e){super(e),t(this,"_ignoreLocaleNumberFormat");const{minMove2:i,ignoreLocaleNumberFormat:r}=e;this._ignoreLocaleNumberFormat=r}hasForexAdditionalPrecision(){return 10===this._minMove2}_parseUnsigned(e,t){return this._parseAsDecimal(e,t)}_formatUnsigned(e,t,i,r,n,o){const a={price:Math.abs(e),priceScale:this._priceScale,minMove:this._minMove,fractionalLength:this._fractionalLength,tailSize:t,cutFractionalByPrecision:i,ignoreLocaleNumberFormat:n,removeAllEndingZeros:o};if(void 0!==this._variableMinTickData){const e=w(!1,this._variableMinTickData,r??a.price);Object.assign(a,e),this._ignoreMinMove&&(a.minMove=1)}return this._formatAsDecimal(a)}_formatAsExponential(e,t){const i=Math.floor(.75*Math.log10(this._priceScale)),r=e*Math.pow(10,i),n=`e-${i}`,o=Math.log10(this._priceScale)-i;return`${r.toFixed(o).replace(".",t.decimalSign)}${n}`}_formatAsDecimal(e){const{price:t,priceScale:i,minMove:r,fractionalLength:n=0,tailSize:o=0,cutFractionalByPrecision:a,ignoreLocaleNumberFormat:s,removeAllEndingZeros:c}=e,u=l(this._ignoreLocaleNumberFormat||s);if(t>=1e21)return t.toString().replace(".",u.decimalSign);if(i>1e15)return this._formatAsExponential(t,u);const p=Math.pow(10,o)*i/(a?1:r),f=1/p;let v;if(p>1)v=Math.floor(t);else{const e=Math.floor(Math.round(t/f)*f);v=0===Math.round((t-e)/f)?e:e+f}let M="";if(p>1){let e;if(a){e=new m(t).times(p).round().minus(new m(v).times(p)).toNumber()}else{const i=Math.round(t*p)-v*p;e=parseFloat(i.toFixed(n))}e>=p&&(e-=p,v+=1),a?e=new m(e).round(n).toNumber():e*=r;const i=_(e,n+o),s=this._removeEndingZeros(i,c?i.length:o);M=s?u.decimalSign+s:""}return h(v,u)+M}_parseAsDecimal(e,t={}){const{ignoreLocaleNumberFormat:i}=t,r=l(this._ignoreLocaleNumberFormat||i),n=u(e,r);return Number.isFinite(n)?{value:n,res:!0,suggest:this.formatImpl(n)}:{error:this._formatterErrors.custom,res:!1}}}const x=/^\d+([.,]\d+)?$/;class k extends F{constructor(e){super(e);const{minMove2:t}=e;null!=t&&t>0&&2!==t&&4!==t&&8!==t&&console.warn("invalid minmove2")}hasForexAdditionalPrecision(){return!1}_parseUnsigned(e){return this._minMove2?this._parseAsDoubleFractional(e):this._parseAsSingleFractional(e)}_formatUnsigned(e,t,i,r){const n={price:Math.abs(e),priceScale:this._priceScale,minMove:this._minMove,minMove2:this._minMove2,fractionalLength:a(this._fractionalLength),tailSize:t};return void 0!==this._variableMinTickData&&Object.assign(n,w(!0,this._variableMinTickData,r??n.price)),this._formatAsFractional(n)}_parseAsSingleFractional(e){if(x.test(e)){const t=parseFloat(e);return{value:t,res:!0,suggest:this.formatImpl(t)}}const t=new RegExp(`^(-?)(\\d+)\\${c.decimalSignFractional}(\\d+)$`).exec(e);if(t){const e=!!t[1],i=parseInt(t[2]),r=parseInt(t[3]),n=this._priceScale,o=this._patchFractPart(r,1,n);if(o>=n||o<0)return{error:this._formatterErrors.fraction,res:!1};let a=i+o/n;return e&&(a=-a),{value:a,res:!0,suggest:this.formatImpl(a)}}return{error:this._formatterErrors.custom,res:!1}}_parseAsDoubleFractional(e){if(x.test(e)){const t=parseFloat(e);return{value:t,res:!0,suggest:this.formatImpl(t)}}const t=new RegExp(`^(-?)(\\d+)\\${c.decimalSignFractional}(\\d+)\\${c.decimalSignFractional}(\\d+)$`).exec(e);if(t){const e=!!t[1],i=parseInt(t[2]),r=parseInt(t[3]),n=parseInt(t[4]),o=this._minMove2,a=this._priceScale/o,s=this._patchFractPart(r,1,a),c=this._patchFractPart(n,2,o);if(s>=a||s<0)return{error:this._formatterErrors.fraction,res:!1};if(c>=o||c<0)return{error:this._formatterErrors.secondFraction,res:!1};let l=i+s/a+c/(a*o);return e&&(l=-l),{value:l,res:!0,suggest:this.formatImpl(l)}}return{error:this._formatterErrors.custom,res:!1}}_formatAsFractional(e){const{price:t,tailSize:i,priceScale:r,minMove:n,minMove2:o,fractionalLength:a}=e,s=r/n;let l=Math.floor(t),m=i?Math.floor(t*s)-l*s:Math.round(t*s)-l*s;m===s&&(l+=1,m=0);let h="";if(i){let e=(t-l-m/s)*s;e=Math.round(e*10**i),h=_(e,i),h=this._removeEndingZeros(h,i)}if(null==a)throw new Error("_fractionalLength is not calculated");let u="";if(o){const e=m%o;m=(m-e)/o;const t=_(m,a),i=this._getFractPart(e,2,o);u=t+c.decimalSignFractional+i}else{u=_(this._getFractPart(m,1,r)*n,a)}return l.toString()+c.decimalSignFractional+u+h}_patchFractPart(e,t,i){return 2===i?Reflect.get({0:0,5:1},e)??-1:4===i?Reflect.get({0:0,2:1,5:2,7:3},e)??-1:8===i&&2===t?Reflect.get({0:0,1:1,2:2,3:3,5:4,6:5,7:6,8:7},e)??-1:e}_getFractPart(e,t,i){return 2===i?[0,5][e]??-1:4===i?[0,2,5,7][e]??-1:8===i&&2===t?[0,1,2,3,5,6,7,8][e]??-1:e}}class E{constructor(e={}){t(this,"type","price"),t(this,"_priceScale"),t(this,"_minMove"),t(this,"_minMove2"),t(this,"_fractional"),t(this,"_variableMinTick"),t(this,"_ignoreMinMove"),t(this,"_fractionalLength"),t(this,"_ignoreLocaleNumberFormat"),t(this,"_implementation");const{minMove2:i,fractional:r,variableMinTick:a,ignoreMinMove:s,ignoreLocaleNumberFormat:c}=e,l=!e.minMove||s?1:e.minMove,m=o(e.priceScale)&&n(e.priceScale)?e.priceScale:100;if(m<0)throw new TypeError("Invalid priceScale base");const h=S(m,l,r,i),u={...e,minMove:l,priceScale:m,fractionalLength:h};this._priceScale=m,this._minMove=l,this._minMove2=i,this._fractional=r,this._variableMinTick=a,this._ignoreMinMove=s,this._ignoreLocaleNumberFormat=c,this._fractionalLength=h,this._implementation=r?new k(u):new N(u)}isFractional(){return!!this._fractional}state(){return{minMove:this._minMove,minMove2:this._minMove2,priceScale:this._priceScale,variableMinTick:this._variableMinTick,ignoreMinMove:this._ignoreMinMove,fractional:this._fractional}}formatChange(e,t,i={}){return this._implementation.formatImpl(t-e,{...i,variableMinTickDataPrice:Math.min(Math.abs(e),Math.abs(t))})}format(e,t){return this._implementation.formatImpl(e,t)}parse(e,t){return this._implementation.parse(e,t)}hasForexAdditionalPrecision(){return this._implementation.hasForexAdditionalPrecision()}static serialize(e){return e.state()}static deserialize(e){return new E(e)}}class L extends E{constructor(e={}){void 0!==e.decimalPlaces&&(e.priceScale=Math.pow(10,e.decimalPlaces)),super(e),t(this,"type","percentage")}state(){return{...super.state(),percent:!0}}parse(e,t){const i=e.replace("%","");return super.parse(i,t)}format(e,t={}){const{useRtlFormat:i=!0}=t,r=super.format(e,{...t,useRtlFormat:!1})+"%";return i?f(r):r}static serialize(e){return e.state()}static deserialize(e){return new L(e)}}class T extends E{constructor(e){var i=(...e)=>(super(...e),t(this,"_isForex"),t(this,"_pipPriceScale"),t(this,"_pipMinMove"),t(this,"_pipMinMove2"),this);const{priceScale:r,minMove:n=1,minMove2:o,type:a,typespecs:s,ignoreLocaleNumberFormat:c}=e;var l;("forex"===a||(l=a,!!(null==s?void 0:s.includes("cfd"))&&["commodity","futures","index","stock","fund"].includes(l)))&&o?(i({priceScale:o,ignoreLocaleNumberFormat:c}),this._isForex=!0):(i({priceScale:1,ignoreLocaleNumberFormat:c}),this._isForex=!1),this._pipPriceScale=r,this._pipMinMove=n,this._pipMinMove2=o}format(e,t={}){const i=this._isForex?this._pipMinMove2:this._pipMinMove,r=this._pipPriceScale/(i??NaN);return super.format(e*r,t)}}const y=M((e=>new p({precision:e}))),P=M((e=>new L({priceScale:Math.pow(10,e??2),minMove:1}))),I=new WeakMap;function A(e){let t=I.get(e);return t||(t=new T({priceScale:e.pricescale,minMove:e.minmov,minMove2:e.minmove2,type:e.type,typespecs:e.typespecs}),I.set(e,t)),t}export{A as a,y as b,P as g,_ as n};
