var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{bD as i,u as s,aZ as n,bG as l,cj as o,y as a,z as r,bH as c,A as h,L as d}from"./index-5gyre0hA.js";import{a as p,D as f}from"./toolPaneView-BkZhzbTB.js";import{s as u}from"./index-iNH1zFVl.js";import{P as w}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as x}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as m,T as _}from"./axisPaneView-B6qY_qE1.js";import{H as y,V as b}from"./text-BhorOBkg.js";import{C as P}from"./composite-CCMtJLBO.js";import{L as j}from"./line-BKuOqRrm.js";import{F as g}from"./paneView-MhvZ7TYs.js";import"./baseTool-BM5mqL4_.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";import"./formatter-BMswhHnL.js";import"./numericFormatter-DcPXx81O.js";class A extends i{hitTest(e){var t;if(!this._data)return null;if((null==(t=this._data)?void 0:t.points.length)<2)return null;const i=this._data.points[0],n=this._data.points[1],l=.5*Math.abs(i.x-n.x),a=Math.abs(i.x-n.x),r=Math.abs(i.y-n.y);if(a<1||r<1)return null;const c=i.add(n).scaled(.5);let h=e.subtract(c);const d=(n.y-i.y)/(n.x-i.x);h=new s(h.x,h.y/d);let p=h.x*h.x+h.y*h.y-l*l;return p=o(p)*Math.sqrt(Math.abs(p/l)),Math.abs(p)<3?this._hitTest:this._data.fillBackground&&!this._data.noHitTestOnBackground&&p<3?this._backgroundHitTest:null}drawImpl(e){if(!this._data)return;const t=e.context;t.lineCap="butt",t.strokeStyle=this._data.color,t.lineWidth=this._data.linewidth,void 0!==this._data.linestyle&&n(t,this._data.linestyle);const i=this._data.points[0],s=this._data.points[1],o=Math.abs(i.x-s.x),a=Math.abs(i.y-s.y);if(o<1||a<1)return;const r=i.add(s).scaled(.5);let c=0;if(this._data.wholePoints){const[e,t]=this._data.wholePoints;c=Math.abs(e.x-t.x)}t.save(),t.translate(r.x,r.y),t.scale(1,a/o),t.beginPath(),t.arc(0,0,o/2,0,2*Math.PI,!1),t.restore(),t.stroke(),this._data.fillBackground&&(this._data.wholePoints&&(t.translate(r.x,r.y),t.scale(1,a/o),t.arc(0,0,c/2,0,2*Math.PI,!0)),t.fillStyle=l(this._data.backcolor,this._data.transparency,!0),t.fill())}}class V extends g{constructor(){super(...arguments),t(this,"_trendLineRenderer",new j),t(this,"_renderer",new P(this._hitTestCollector))}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this.points();if((null==e?void 0:e.length)<2)return;const[t,i]=e,n=t.add(i).scaled(.5),l=Math.abs(i.x-t.x),o=Math.abs(i.y-t.y),h=[],d=this._source.properties();d.levels.forEach(((e,t)=>{const i=e.coeff,a=e.color,r=[new s(n.x-.5*l*i,n.y-.5*o*i),new s(n.x+.5*l*i,n.y+.5*o*i)],c=new s(n.x,n.y+.5*o*i);h.push({color:a,points:r,labelPoint:c,linewidth:e.linewidth,linestyle:e.linestyle,index:t,coeff:e.coeff})}));const p=d.fillBackground,f=d.transparency;for(let s=0;s<h.length;s++){const e=h[s],t=new A({points:e.points,color:e.color,linewidth:e.linewidth,backcolor:e.color,wholePoints:s>0?h[s-1].points:void 0,fillBackground:p,transparency:f});t.setHitTest(new a(r.MovePoint)),this._renderer.append(t);const i=this._updateLabelForLevel({levelIndex:e.index,coeff:e.coeff,color:e.color,price:"",vertAlign:b.Middle,horzAlign:y.Left,leftPoint:e.labelPoint,rightPoint:e.labelPoint});null!==i&&this._renderer.append(i)}const u=d.trendline;u.visible&&(this._trendLineRenderer.setData({points:[t,i],lineColor:u.color,lineWidth:u.linewidth,lineStyle:u.linestyle,extendLeft:!1,extendRight:!1,leftEnd:c.Normal,rightEnd:c.Normal}),this._renderer.append(this._trendLineRenderer)),this.addAnchors(this._renderer)}}class M extends p{constructor(){super(...arguments),t(this,"_lines",new V(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new m(Object.create(null))]),t(this,"_timeAxisPaneViews",[new _(Object.create(null))]),t(this,"_timeAxisViews",[new x(Object.create(null)),new x(Object.create(null))]),t(this,"_priceAxisViews",[new w(Object.create(null)),new w(Object.create(null))])}pointsCount(){return 2}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let s=0;s<this.controlPoints.length;s++){const t=this.controlPoints[s],i=this.pointToScreenPoint(t);if(!i)return;e.push(new h(i,{pointIndex:s}))}const t=e.map((e=>e.x)),i=e.map((e=>e.y));this.controlPoints.forEach(((t,i)=>{this._timeAxisViews[i].update(this._calculateTimeAxisViewData(t.time,e[i].x)),this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,e[i].y))})),t.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,t),Math.max.apply(null,t))),i.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,i),Math.max.apply(null,i))),this._lines.update({points:e})}}class v extends f{constructor(){super(...arguments),t(this,"type",u)}createPrimitive(){return new M({id:this.id,points:[],levels:[{coeff:.236,color:"#F23645",linestyle:d.solid,linewidth:2},{coeff:.382,color:"#FF9800",linestyle:d.solid,linewidth:2},{coeff:.5,color:"#4CAF50",linestyle:d.solid,linewidth:2},{coeff:.618,color:"#089981",linestyle:d.solid,linewidth:2},{coeff:.786,color:"#00BCD4",linestyle:d.solid,linewidth:2},{coeff:1,color:"#808080",linestyle:d.solid,linewidth:2},{coeff:1.618,color:"#2962FF",linestyle:d.solid,linewidth:2},{coeff:2.618,color:"#E91E63",linestyle:d.solid,linewidth:2},{coeff:3.618,color:"#2962FF",linestyle:d.solid,linewidth:2},{coeff:4.236,color:"#E91E63",linestyle:d.solid,linewidth:2},{coeff:4.618,color:"#F23645",linestyle:d.solid,linewidth:2}],transparency:80,fillBackground:!0,showCoeffs:!0,coeffsAsPercents:!1,trendline:{visible:!0,color:"#808080",linewidth:2,linestyle:d.dashed}},...this.resetArgs)}}export{v as FibCirclesTool};
