var t=Object.defineProperty,e=(e,i,s)=>((e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s)(e,"symbol"!=typeof i?i+"":i,s);import{u as i,bD as s,y as n,z as a,aZ as o,A as r,e as l,L as h}from"./index-5gyre0hA.js";import{T as c,a as d,D as u}from"./toolPaneView-BkZhzbTB.js";import{q as p}from"./index-iNH1zFVl.js";import{P as x}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as m}from"./timeLabelTimeAxisView-DLVMuesT.js";import{T as _}from"./axisPaneView-B6qY_qE1.js";import{C as w}from"./composite-CCMtJLBO.js";import"./baseTool-BM5mqL4_.js";class f extends s{hitTest(t){if(null===this._data)return null;const{point:e,width:s,height:o}=this._data;if(t.y>e.y)return null;if(t.x<e.x||t.x>e.x+s)return null;const r=new i(e.x+s/2,e.y);let l=t.subtract(r);const h=o/s;l=new i(l.x,l.y/h);const c=l.length(),d=s/2;return Math.abs(c-d)<3?new n(a.MovePoint):null}drawImpl(t){if(null===this._data)return;const e=t.context;e.strokeStyle=this._data.color,e.lineWidth=this._data.linewidth,o(e,this._data.linestyle),e.save(),e.translate(this._data.point.x+1,this._data.point.y),e.scale(this._data.width,this._data.height),e.beginPath(),e.arc(.5,0,.5,Math.PI,0,!1),e.restore(),e.stroke(),this._data.fillBackground&&(e.fillStyle=this._data.backcolor,e.fill())}}class P extends c{constructor(){super(...arguments),e(this,"_renderer",new w(this._hitTestCollector))}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const t=this.points();if((null==t?void 0:t.length)<2)return;const e=this._source.properties();for(let s=0;s<this._data.xPositions.length;s++){const t={point:new i(this._data.xPositions[s],this._data.baseY),width:this._data.boxWidth,height:this._data.boxWidth,color:e.lineColor,linewidth:e.lineWidth,linestyle:e.lineStyle,fillBackground:e.fillBackground,backcolor:e.background},n=new f(t);this._renderer.append(n)}this.addAnchors(this._renderer)}}class b extends d{constructor(){super(...arguments),e(this,"_lines",new P(this,this.model)),e(this,"_paneView",[this._lines]),e(this,"_timeAxisPaneViews",[new _(Object.create(null))]),e(this,"_timeAxisViews",[new m(Object.create(null)),new m(Object.create(null))]),e(this,"_priceAxisViews",[new x(Object.create(null)),new x(Object.create(null))])}pointsCount(){return 2}addPoint(t,e){return 1===e&&(t.price=this.controlPoints[0].price),super.addPoint(t,e)}setPoint(t,e,i){super.setPoint(t,e,i),this.controlPoints.forEach((t=>t.price=e.price))}updateAllViews(){if(!this.controlPoints.length)return;const t=[];for(let l=0;l<this.controlPoints.length;l++){const e=this.controlPoints[l],i=this.pointToScreenPoint(e);if(!i)return;t.push(new r(i,{pointIndex:l}))}const e=t.map((t=>t.x));this.controlPoints.forEach(((e,i)=>{this._timeAxisViews[i].update(this._calculateTimeAxisViewData(e.time,t[i].x)),this._priceAxisViews[i].update(this._calculatePriceAxisViewData(e.price,t[i].y))})),e.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,e),Math.max.apply(null,e)));const i=l(this.chart.timeScale().timeToIndexEx(this.controlPoints[0].time)),s=l(this.chart.timeScale().timeToIndexEx(this.controlPoints[1].time)),n=Math.min(i,s),a=Math.max(i,s),o=a-n;if(0===o)return;const h=t[0],c=t[1],d=Math.abs(h.x-c.x),u=h.y;let p=Math.min(h.x,c.x);const x=[];for(let r=n;p>-d;r-=o)p=l(this.chart.timeScale().logicalToCoordinate(r)),x.push(p);let m=Math.max(h.x,c.x);for(let r=a;m<this.chart.timeScale().width();r+=o)m=l(this.chart.timeScale().logicalToCoordinate(r)),x.push(m);this._lines.update({points:t,boxWidth:d,baseY:u,xPositions:x})}}class g extends u{constructor(){super(...arguments),e(this,"type",p)}createPrimitive(){return new b({id:this.id,points:[],lineColor:"#159980FF",background:"#6AA84F7F",fillBackground:!0,lineWidth:2,lineStyle:h.solid},...this.resetArgs)}}export{g as TimeCyclesTool};
