var e=Object.defineProperty,t=(t,i,n)=>((t,i,n)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n)(t,"symbol"!=typeof i?i+"":i,n);import{cn as i,L as n,bH as r,r as s,A as l,b$ as o,aj as a}from"./index-5gyre0hA.js";import{T as h,a as d,D as c}from"./toolPaneView-BkZhzbTB.js";import{a2 as p}from"./index-iNH1zFVl.js";import{P as u}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as f}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as _,T as m}from"./axisPaneView-B6qY_qE1.js";import{B as w,V as b,H as g}from"./text-BhorOBkg.js";import{C as x}from"./composite-CCMtJLBO.js";import{L as j}from"./line-BKuOqRrm.js";import{P as R}from"./polygon-D49cV0Ps.js";import{T as A}from"./triangle-BThRCISa.js";import"./baseTool-BM5mqL4_.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";import"./line-Jebc4sVj.js";class P extends h{constructor(){super(...arguments),t(this,"_renderer",new x(this._hitTestCollector)),t(this,"_trendLineRenderer",new j),t(this,"_triangleRendererPoints234",new A),t(this,"_intersect1Renderer",new A),t(this,"_intersect2Renderer",new A),t(this,"_polyLineRenderer",new R),t(this,"_leftShoulderLabelRenderer",new w),t(this,"_headLabelRenderer",new w),t(this,"_rightShoulderLabelRenderer",new w)}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this.points();if(!(null==e?void 0:e.length))return;let t,l;const[o,a,h,d,c,p,u]=e;if(e.length>=5){const n=i(h,c,o,a);if(n){const e=c.subtract(h);t=h.add(e.scaled(n))}if(7===e.length){const e=i(h,c,p,u);if(e){const t=c.subtract(h);l=h.add(t.scaled(e))}}}if(e.length<2)return;const f=this._source.properties(),_=(e,t)=>({points:[e],text:t,color:f.textColor,horzAlign:g.Center,vertAlign:b.Middle,fontFamily:s,offsetX:0,offsetY:0,fontSize:f.textFontSize,backgroundColor:f.lineColor,backgroundRoundRect:4}),m=(e,t,i)=>({points:[e,t,i],color:"rgba(0, 0, 0, 0)",lineWidth:0,backColor:f.background,fillBackground:f.fillBackground}),w={points:e,lineColor:f.lineColor,lineWidth:f.lineWidth,lineStyle:n.solid,filled:!1,background:"rgba(0, 0, 0, 0)"};if(this._polyLineRenderer.setData(w),this._renderer.append(this._polyLineRenderer),e.length>=5){let e=h,i=c,s=!1,o=!1;t?e=t:(e=h,s=!0),l?i=l:(i=c,o=!0);const a={points:[e,i],lineColor:f.lineColor,lineWidth:f.lineWidth,lineStyle:n.dotted,extendLeft:s,extendRight:o,leftEnd:r.Normal,rightEnd:r.Normal};this._trendLineRenderer.setData(a),this._renderer.append(this._trendLineRenderer);const p=m(h,d,c);this._triangleRendererPoints234.setData(p),this._renderer.append(this._triangleRendererPoints234)}if(t){const e=m(t,a,h);this._intersect1Renderer.setData(e),this._renderer.append(this._intersect1Renderer)}if(l){const e=m(c,p,l);this._intersect2Renderer.setData(e),this._renderer.append(this._intersect2Renderer)}if(e.length>=2){const e=_(a,"Left Shoulder");e.vertAlign=a.y<o.y?b.Bottom:b.Top,e.offsetY=5,this._leftShoulderLabelRenderer.setData(e),this._renderer.append(this._leftShoulderLabelRenderer)}if(e.length>=4){const e=_(d,"Head");e.vertAlign=d.y<h.y?b.Bottom:b.Top,e.offsetY=5,this._headLabelRenderer.setData(e),this._renderer.append(this._headLabelRenderer)}if(e.length>=6){const e=_(p,"Right Shoulder");e.vertAlign=p.y<c.y?b.Bottom:b.Top,e.offsetY=5,this._rightShoulderLabelRenderer.setData(e),this._renderer.append(this._rightShoulderLabelRenderer)}this.addAnchors(this._renderer)}}class y extends d{constructor(){super(...arguments),t(this,"_lines",new P(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new _(Object.create(null))]),t(this,"_timeAxisPaneViews",[new m(Object.create(null))]),t(this,"_timeAxisViews",[new f(Object.create(null)),new f(Object.create(null)),new f(Object.create(null)),new f(Object.create(null)),new f(Object.create(null)),new f(Object.create(null)),new f(Object.create(null))]),t(this,"_priceAxisViews",[new u(Object.create(null)),new u(Object.create(null)),new u(Object.create(null)),new u(Object.create(null)),new u(Object.create(null)),new u(Object.create(null)),new u(Object.create(null))])}pointsCount(){return 7}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let n=0;n<this.controlPoints.length;n++){const t=this.controlPoints[n],i=this.pointToScreenPoint(t);if(!i)return;e.push(new l(i,{pointIndex:n}))}const t=e.map((e=>e.x)),i=e.map((e=>e.y));this.controlPoints.forEach(((t,i)=>{this._timeAxisViews[i].update(this._calculateTimeAxisViewData(t.time,e[i].x)),this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,e[i].y))})),t.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,t),Math.max.apply(null,t))),i.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,i),Math.max.apply(null,i))),this._lines.update({points:e})}}class L extends c{constructor(){super(...arguments),t(this,"type",p)}createPrimitive(){return new y({id:this.id,points:[],lineColor:"#089981FF",lineWidth:2,fillBackground:!0,background:o("#089981FF",.15),textColor:"#ffffff",textFontSize:12,leftText:this.chartService.invokeWithinContext((e=>e.get(a).t("tool.headAndShoulders.left"))),headText:this.chartService.invokeWithinContext((e=>e.get(a).t("tool.headAndShoulders.head"))),rightText:this.chartService.invokeWithinContext((e=>e.get(a).t("tool.headAndShoulders.right")))},...this.resetArgs)}}export{L as PatternHeadAndShouldersTool};
