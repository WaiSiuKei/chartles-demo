var e=Object.defineProperty,t=(t,i,r)=>((t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r)(t,"symbol"!=typeof i?i+"":i,r);import{A as i,bH as r,L as s}from"./index-5gyre0hA.js";import{T as n,a,D as o}from"./toolPaneView-BkZhzbTB.js";import{ag as l}from"./index-iNH1zFVl.js";import{P as c}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as d}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as p,T as h}from"./axisPaneView-B6qY_qE1.js";import{A as m,a as u,F as _}from"./primitive-DdJ8hN9g.js";import{C as w}from"./composite-CCMtJLBO.js";import{L as x}from"./line-BKuOqRrm.js";import"./baseTool-BM5mqL4_.js";import"./text-BhorOBkg.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";import"./paneView-MhvZ7TYs.js";import"./formatter-BMswhHnL.js";import"./numericFormatter-DcPXx81O.js";class f extends n{constructor(){super(...arguments),t(this,"_arcWedgeRenderer",new m),t(this,"_baseTrendRenderer",new x),t(this,"_edgeTrendRenderer",new x),t(this,"_renderer",new w(this._hitTestCollector))}renderer(){return this._renderer}_updateImpl(){u.prototype._updateImpl.call(this)}_getPoints(){const e=this.points();if(e.length<3)return e;const[t,r,s]=e,n=s.pointIndex,a=r.subtract(t).length(),o=s.subtract(t).normalized().scaled(a),l=new i(t.add(o),{pointIndex:n});return[t,r,l]}_updateRenderer(e=NaN,t=NaN,i=[]){const s=this.points();if(s.length<2)return;const n=this._source.properties(),[a,o,l]=this._getPoints(),c=n.trendline.color,d=n.lineWidth,p=n.trendline.linestyle;if(this._baseTrendRenderer.setData({points:[a,o],lineColor:c,lineWidth:d,lineStyle:p,extendLeft:!1,extendRight:!1,leftEnd:r.Normal,rightEnd:r.Normal}),this._renderer.append(this._baseTrendRenderer),s.length<3)return void this.addAnchors(this._renderer);this._edgeTrendRenderer.setData({points:[a,l],lineColor:c,lineWidth:d,lineStyle:p,extendLeft:!1,extendRight:!1,leftEnd:r.Normal,rightEnd:r.Normal}),this._renderer.append(this._edgeTrendRenderer);const h=i[0];this._arcWedgeRenderer.setData({center:a,radius:h.radius,prevRadius:0,color:c,color1:n.color0,color2:n.color1,linewidth:d,angle1:e,angle2:t,p1:h.p1,p2:h.p2,fillBackground:n.fillBackground,transparency:n.transparency,gradient:!0}),this._renderer.append(this._arcWedgeRenderer),this.addAnchors(this._renderer)}}class g extends a{constructor(){super(...arguments),t(this,"_lines",new f(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new p(Object.create(null))]),t(this,"_timeAxisPaneViews",[new h(Object.create(null))]),t(this,"_timeAxisViews",[new d(Object.create(null)),new d(Object.create(null)),new d(Object.create(null))]),t(this,"_priceAxisViews",[new c(Object.create(null)),new c(Object.create(null)),new c(Object.create(null))])}pointsCount(){return 3}setPoint(e,t,i){_.prototype.setPoint.call(this,e,t,i)}addPoint(e,t){return _.prototype.addPoint.call(this,e,t)}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let s=0;s<this.controlPoints.length;s++){const t=this.controlPoints[s],r=this.pointToScreenPoint(t);if(!r)return;e.push(new i(r,{pointIndex:s}))}const t=e.map((e=>e.x)),r=e.map((e=>e.y));this.controlPoints.forEach(((t,i)=>{this._timeAxisViews[i].update(this._calculateTimeAxisViewData(t.time,e[i].x)),this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,e[i].y))})),t.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,t),Math.max.apply(null,t))),r.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,r),Math.max.apply(null,r))),this._lines.update({points:e})}}class j extends o{constructor(){super(...arguments),t(this,"type",l)}createPrimitive(){return new g({id:this.id,points:[],showCoeffs:!0,fillBackground:!0,transparency:80,color0:"#2962FF",color1:"#9C27B0",lineWidth:2,trendline:{visible:!0,color:"#9C9C9C",linestyle:s.solid},levelsStyle:{linewidth:2,linestyle:s.solid},levels:[{coeff:1,color:"#808080"}]},...this.resetArgs)}}export{j as ProjectionTool};
