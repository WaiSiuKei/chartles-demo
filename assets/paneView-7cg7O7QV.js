var t=Object.defineProperty,e=(e,s,i)=>((e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i)(e,"symbol"!=typeof s?s+"":s,i);import{D as s,a as i,T as n}from"./toolPaneView-BkZhzbTB.js";import{e as r,u as o,A as a,z as l,bF as c,bG as h,bD as p,y as d}from"./index-5gyre0hA.js";import{t as u,r as g}from"./transform-CddyjF1Y.js";import{P as _}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as m}from"./timeLabelTimeAxisView-DLVMuesT.js";import{t as x}from"./handle-C11jaV9I.js";import{C as P}from"./composite-CCMtJLBO.js";import{s as w}from"./svg-D8gy4lKT.js";class b extends s{}class f extends i{constructor(){super(...arguments),e(this,"_lines"),e(this,"_timeAxisViews",[new m(Object.create(null))]),e(this,"_priceAxisViews",[new _(Object.create(null))]),e(this,"_changePointData",null)}startChanging(t,e){const s=r(this.pointToScreenPoint(this.controlPoints[0])),i=this.properties(),n=i.size;let a;if(e)a=r(this.pointToScreenPoint(e));else{const t=new o(0,Math.max(80,n)/2),e=i.angle,r=g(e),l=u(r,t);a=s.add(l)}const l=s.subtract(a).length();this._changePointData={centerPoint:s,initialLength:l,initialSize:n}}setPoint(t,e){const{centerPoint:s,initialLength:i,initialSize:n}=r(this._changePointData),o=r(this.pointToScreenPoint(e)),a=this.properties();if(0===t||1===t){const e=o.subtract(s).normalized();let i=Math.acos(-e.x);Math.asin(e.y)>0&&(i=2*Math.PI-i),0===t&&(i+=Math.PI),a.angle=i}else{const t=n*(s.subtract(o).length()/i);a.size=t}}updateAllViews(){if(!this.controlPoints.length)return;const t=[];for(let e=0;e<this.controlPoints.length;e++){const s=this.controlPoints[e],i=this.pointToScreenPoint(s);if(!i)return;const n=new a(i,{pointIndex:e,hitTarget:l.ChangePoint});t.push(n),this._timeAxisViews[e].update(this._calculateTimeAxisViewData(s.time,i.x)),this._priceAxisViews[e].update(this._calculatePriceAxisViewData(s.price,i.y))}this._lines.update({points:t})}}class y extends p{drawImpl(t){if(null===this._data)return;const{size:e,svg:s,point:i,angle:n,color:r,background:o,selected:a}=this._data,l=t.context;l.translate(i.x,i.y);const c=n-Math.PI/2;l.rotate(c);const h=e/2;a&&(l.fillStyle=o,l.strokeStyle="#1E53E5",l.beginPath(),l.rect(-h,-h,e,e),l.closePath(),l.fill(),l.stroke()),s&&(l.translate(-h,-h),null!==r&&(l.fillStyle=r),s.render(l,{targetViewBox:{x:0,y:0,width:e,height:e},doNotApplyColors:null!==r}))}hitTest(t){if(null===this._data)return null;const{size:e,angle:s,point:i}=this._data,n=g(-s),r=u(n,t.subtract(i)),o=e/2;return Math.abs(r.x)<=o&&Math.abs(r.y)<=o?new d(l.MovePoint):null}isOutOfScreen(t,e){if(null===this._data)return!0;const{size:s,point:i,angle:n}=this._data;let r;r=n%(Math.PI/2)==0?s/2:Math.sqrt(s**2*2)/2;return i.x+r<0||i.x-r>e||i.y+r<0||i.y-r>t}}class A extends n{constructor(){super(...arguments),e(this,"_renderer",new P(this._hitTestCollector)),e(this,"_iconRenderer",new y),e(this,"_svgRenderer")}renderer(){return this._renderer}_updateImpl(){if(this._renderer.clear(),this.points().length<1)return;const t=this._source.properties(),e=t.size,s=t.angle,i=this.areAnchorsVisible();this._svgRenderer||(this._svgRenderer=w(t.icon));const n={point:this.points()[0],color:this._iconColor(),background:this._calculateBackgroundColor(),svg:this._svgRenderer,size:e,angle:s,selected:i};this._iconRenderer.setData(n);const r=this._source.getScope(),{mediaSize:{width:l,height:h}}=r;this._iconRenderer.isOutOfScreen(h,l)||this._renderer.append(this._iconRenderer);const[p]=this.points(),d=Math.max(80,e)/2;let _=new o(d,0),m=new o(0,d);const P=g(s);_=u(P,_),m=u(P,m);const b=p.add(_),f=p.subtract(_),y=p.add(m),A=p.subtract(m),S=x(b,f),T=[new a(b,{pointIndex:0}),new a(f,{pointIndex:1}),new a(y,{pointIndex:2,cursorType:S,style:c.square}),new a(A,{pointIndex:3,cursorType:S,style:c.square})],z=this.createLineAnchor({points:T},0);this._renderer.append(z)}_calculateBackgroundColor(){return h(this._model.backgroundColorAtYPercentFromTop(this.points()[0].y/this._source.series.getPane().getHeight()),60,!0)}}export{A as S,f as a,b};
