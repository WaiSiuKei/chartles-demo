var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{g as i}from"./toolPaneView-BkZhzbTB.js";import{b as s,B as r,a as n}from"./textPaneView-LQytaZVw.js";import{as as o}from"./index-iNH1zFVl.js";import{r as a,y as l,z as h,M as d,bD as p,w as c,u,v as m,G as _,aY as x,A as f}from"./index-5gyre0hA.js";import{P as b}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as w}from"./timeLabelTimeAxisView-DLVMuesT.js";import{H as g,V as T}from"./text-BhorOBkg.js";import{C}from"./composite-CCMtJLBO.js";import{T as y}from"./renderer-CaYvdS1S.js";import"./baseTool-BM5mqL4_.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";class P extends p{hitTest(e){if(null===this._data||0===this._data.points.length)return null;const{points:[t],innerWidth:i,innerHeight:s}=this._data,r=t.x,n=t.y-s,o=c(new u(r,n),new u(r+i,n+s));return m(e,o)?new l(h.MovePoint,{areaName:d.Text,cursorType:_.text}):null}drawImpl(e){if(null===this._data||0===this._data.points.length)return;const t=e.context,{points:[i],innerWidth:s,innerHeight:r,backgroundColor:n,borderColor:o,borderRadius:a}=this._data,l=i.x,h=i.y-r;t.translate(l,h),x(t,0,0,s,r,[a,a,a,2]),t.fillStyle=n,t.fill(),t.strokeStyle=o,t.lineWidth=2,t.stroke(),t.closePath()}}class j extends s{constructor(){super(...arguments),t(this,"_renderer",new C(this._hitTestCollector)),t(this,"_labelRenderer",new y),t(this,"_commentRenderer",new P)}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this._source.properties(),t={text:this._textDisplay(),fontSize:e.fontSize,offsetX:0,offsetY:0,points:this.points(),vertAlign:T.Bottom,horzAlign:g.Left,fontFamily:a,color:this._textDisplayColor(),boxPaddingVert:Math.round(e.fontSize/1.3),boxPaddingHorz:12};this._labelRenderer.setData(t),this._labelRenderer.setHitTestResult(new l(h.MovePoint,{areaName:d.Text,cursorType:this._textCursorType()}));const i=this._labelRenderer.getTextInfo();this._updateEditor(i);const s=this._labelRenderer.measure(),r={points:this.points(),borderColor:e.borderColor,backgroundColor:e.backgroundColor,innerWidth:s.width,innerHeight:s.height,borderRadius:Math.min(s.width,this._labelRenderer.lineHeight()+2*Math.round(e.fontSize/1.3))/2};if(this._commentRenderer.setData(r),1===r.points.length){const e=this.createLineAnchor({points:r.points},0);this._renderer.append(e)}this._renderer.append(this._commentRenderer),this._isTextEditMode()||this._renderer.append(this._labelRenderer)}}class A extends r{constructor(){super(...arguments),t(this,"_lines",new j(this,this.model,this.editingHelper)),t(this,"_paneView",[this._lines]),t(this,"_timeAxisViews",[new w(Object.create(null))]),t(this,"_priceAxisViews",[new b(Object.create(null))])}pointsCount(){return 1}updateAllViews(){if(!this.controlPoints.length)return;const e=[],t=this.controlPoints[0],i=this.pointToScreenPoint(t);if(!i)return;const s=new f(i,{pointIndex:0,hitTarget:h.ChangePoint});e.push(s),this._timeAxisViews[0].update(this._calculateTimeAxisViewData(t.time,i.x)),this._priceAxisViews[0].update(this._calculatePriceAxisViewData(t.price,i.y)),this._lines.update({points:e})}isCreationFinished(){return this._lines.isCreationFinished()}startTextEditing(){this._lines.startTextEditing()}}class R extends n{constructor(){super(...arguments),t(this,"type",o)}createPrimitive(e){const t=i(e);return new A({id:this.id,points:[],text:"",placeholder:t.t("tool.text.common.addText"),fontSize:16,textColor:"#ffffff",backgroundColor:"#2962FFFF",borderColor:"#2962FFFF",wordWrap:!1},...this.getTextResetArgs(e))}}export{R as CommentTool};
