var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{y as s,z as i,u as r,bH as o,r as n,A as l,L as a}from"./index-5gyre0hA.js";import{T as c,a as f,D as p}from"./toolPaneView-BkZhzbTB.js";import{K as h}from"./index-iNH1zFVl.js";import{P as d}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as m}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as u,T as x}from"./axisPaneView-B6qY_qE1.js";import{B as w,H as _,V as y}from"./text-BhorOBkg.js";import{b as j}from"./formatter-BMswhHnL.js";import{C as P}from"./channel-Q-8H9X-L.js";import{C as A}from"./composite-CCMtJLBO.js";import{L as b}from"./line-BKuOqRrm.js";import"./baseTool-BM5mqL4_.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";import"./numericFormatter-DcPXx81O.js";class g extends c{constructor(){super(...arguments),t(this,"_renderer",new A(this._hitTestCollector)),t(this,"_textRenderers",new Map)}renderer(){return this._renderer}getTextRenderer(e){let t=this._textRenderers.get(e);return t||(t=new w(new s(i.MovePoint)),this._textRenderers.set(e,t)),t}_updateImpl(){this._renderer.clear();const e=this.points();if((null==e?void 0:e.length)<2)return;const t=e[0],l=e[1],a=l.x-t.x,c=l.y-t.y,f=this._source.properties(),p=f.fillBackground,h=f.transparency,d=f.showLabels,m=j(),u=f.levels.reduce(((e,s,i)=>{const r=s.coeff1,o=s.coeff2,n=r/o,f=`${m.format(r)}/${m.format(o)}`,p=s.color;let h,d;return r>o?(h=l.x,d=t.y+c/n):(h=t.x+a*n,d=l.y),e.push({label:f,color:p,x:h,y:d,index:i}),e}),[]);for(let x=0;x<u.length;x++){const e=u[x],l=new r(e.x,e.y);if(p){const s=e.index<4,i=e.index>4&&x>0;if(s){const s=u[x+1];if(s){const i=new P;i.setData({p1:t,p2:l,p3:t,p4:new r(s.x,s.y),color:e.color,transparency:h,hittestOnBackground:!0,extendLeft:!1}),this._renderer.append(i)}}else if(i){const s=u[x-1];if(s){const i=new P;i.setData({p1:t,p2:l,p3:t,p4:new r(s.x,s.y),color:e.color,transparency:h,hittestOnBackground:!0,extendLeft:!1}),this._renderer.append(i)}}}const a=new b;if(a.setData({points:[t,l],lineColor:e.color,lineWidth:f.levelsStyle.linewidth,lineStyle:f.levelsStyle.linestyle,extendLeft:!1,extendRight:!0,leftEnd:o.Normal,rightEnd:o.Normal}),a.setHitTest(new s(i.MovePoint)),this._renderer.append(a),d){const t=this.getTextRenderer(x);t.setData({points:[l],text:e.label,color:e.color,vertAlign:y.Middle,horzAlign:_.Left,fontFamily:n,offsetX:0,offsetY:5,fontSize:12}),this._renderer.append(t)}}this.addAnchors(this._renderer)}}class V extends f{constructor(){super(...arguments),t(this,"_lines",new g(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new u(Object.create(null))]),t(this,"_timeAxisPaneViews",[new x(Object.create(null))]),t(this,"_timeAxisViews",[new m(Object.create(null)),new m(Object.create(null))]),t(this,"_priceAxisViews",[new d(Object.create(null)),new d(Object.create(null))])}pointsCount(){return 2}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let i=0;i<this.controlPoints.length;i++){const t=this.controlPoints[i],s=this.pointToScreenPoint(t);if(!s)return;e.push(new l(s,{pointIndex:i}))}const t=e.map((e=>e.x)),s=e.map((e=>e.y));this.controlPoints.forEach(((t,s)=>{this._timeAxisViews[s].update(this._calculateTimeAxisViewData(t.time,e[s].x)),this._priceAxisViews[s].update(this._calculatePriceAxisViewData(t.price,e[s].y))})),t.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,t),Math.max.apply(null,t))),s.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,s),Math.max.apply(null,s))),this._lines.update({points:e})}}class v extends p{constructor(){super(...arguments),t(this,"type",h)}createPrimitive(){return new V({id:this.id,points:[],linewidth:2,showLabels:!0,fillBackground:!0,transparency:80,levelsStyle:{linewidth:2,linestyle:a.solid},levels:[{coeff1:1,coeff2:8,color:"#FF9800"},{coeff1:1,coeff2:4,color:"#089981"},{coeff1:1,coeff2:3,color:"#4CAF50"},{coeff1:1,coeff2:2,color:"#089981"},{coeff1:1,coeff2:1,color:"#00BCD4"},{coeff1:2,coeff2:1,color:"#2962FF"},{coeff1:3,coeff2:1,color:"#9C27B0"},{coeff1:4,coeff2:1,color:"#E91E63"},{coeff1:8,coeff2:1,color:"#F23645"}]},...this.resetArgs)}}export{v as GannFanTool};
