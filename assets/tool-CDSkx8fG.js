var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{H as i,y as s,z as r,u as n,r as o,A as l,J as a,aL as h,e as d}from"./index-5gyre0hA.js";import{g as c,n as p,V as _,H as u}from"./text-BhorOBkg.js";import{g as x}from"./toolPaneView-BkZhzbTB.js";import{b as f,T as b,B as m,a as w}from"./textPaneView-LQytaZVw.js";import{P as g}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{P}from"./PlusTextRendererDecorator-h8tsWFCo.js";import{C as y}from"./composite-CCMtJLBO.js";import{T}from"./renderer-CaYvdS1S.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";import"./baseTool-BM5mqL4_.js";class v extends f{constructor(){super(...arguments),t(this,"_renderer",new y(this._hitTestCollector)),t(this,"_lineRenderer",new i(void 0,void 0,new s(r.MovePoint))),t(this,"_labelRenderer",new T),t(this,"_mode",b.Preview)}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this.points();if(0===(null==e?void 0:e.length))return;const t=this._source.properties();let i=!0;const{mediaSize:{width:h,height:d}}=this._source.getScope(),p=t.text,_=this._isTextEditMode(),u=this._placeHolderMode();let x;if(t.showLabel&&p||u||_){const s=t.vertLabelsAlign,r=t.horzLabelsAlign;let l=0,a=0;"left"===r?a=3:"right"===r?(a=h,l=3):a=h/2;const p=new n(a,e[0].y);this._labelRenderer.setData({points:[p],text:this._textDisplay(),color:this._textDisplayColor(),vertAlign:s,horzAlign:r,fontFamily:o,offsetX:l,offsetY:0,bold:t.bold,italic:t.italic,fontSize:t.fontSize,forceTextAlign:!0,decorator:u?P.instance():void 0}),this._labelRenderer.setCursorType(this._textCursorType()),this._isTextEditMode()||this._renderer.append(this._labelRenderer),this._needLabelExclusionPath(this._labelRenderer)&&(x=c(this._labelRenderer,h,d)??void 0),i=this._labelRenderer.isOutOfScreen(h,d),i?this.closeTextEditor():this._updateEditor(this._labelRenderer.getTextInfo())}const f={y:e[0].y,lineColor:t.lineColor,lineWidth:t.lineWidth,lineStyle:t.lineStyle,excludeBoundaries:x};this._lineRenderer.setData(f);const b=this._source.controlPoints[0].price;this._lineRenderer.setHitTest(new s(r.MovePoint,{snappingPrice:b}));const m=f.lineWidth/2+1;if(i=i&&(f.y<-m||f.y>d+m),this._renderer.insert(this._lineRenderer,0),!i&&1===e.length&&!this._isTextEditMode()){const t=new l(new n(.9*h,e[0].y),{pointIndex:0,resizeDirections:a}),i=this.createLineAnchor({points:[t]},0);this._renderer.append(i)}}_needLabelExclusionPath(e,t){const i=this._source.properties();return"middle"===(t??i.vertLabelsAlign)&&p(e)}}class A extends m{constructor(){super(...arguments),t(this,"_lines",new v(this,this.model,this.editingHelper)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisViews",[new g(Object.create(null))])}pointsCount(){return 1}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let t=0;t<this.controlPoints.length;t++){const i=this.controlPoints[t],s=this.pointToScreenPoint(i);if(!s)return;e.push(new l(s,{pointIndex:t}))}this.controlPoints.forEach(((t,i)=>{this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,e[i].y,{visible:!0,background:this._props.lineColor}))})),this._paneView[0].update({points:e})}isCreationFinished(){return this._lines.isCreationFinished()}startTextEditing(){return this._lines.startTextEditing()}}class C extends w{constructor(){super(...arguments),t(this,"type",h)}createPrimitive(e){const t=x(e);return new A({id:this.id,points:[],lineColor:"#2962FF",lineWidth:2,lineStyle:0,showPrice:!0,showLabel:!0,textColor:"#2962FF",fontSize:12,bold:!1,italic:!1,horzLabelsAlign:u.Center,vertLabelsAlign:_.Middle,wordWrap:!0,text:"",placeholder:t.t("tool.text.common.addText")},...this.getTextResetArgs(e))}finishDrawing(){d(this._drawingSession).finishDrawing()}}export{C as HorizontalLineTool};
