var e=Object.defineProperty,t=(t,i,n)=>((t,i,n)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n)(t,"symbol"!=typeof i?i+"":i,n);import{u as i,A as n,bH as s,L as r}from"./index-5gyre0hA.js";import{T as o,a as l,D as a}from"./toolPaneView-BkZhzbTB.js";import{k as d}from"./index-iNH1zFVl.js";import{P as h}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as c}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as p,T as u}from"./axisPaneView-B6qY_qE1.js";import{C as m}from"./composite-CCMtJLBO.js";import{D as x}from"./disjointChannel-BfVJD7oN.js";import{L as _}from"./line-BKuOqRrm.js";import"./baseTool-BM5mqL4_.js";import"./parallelChannel-DC2OIzzc.js";import"./line-Jebc4sVj.js";class w extends o{constructor(){super(...arguments),t(this,"_trendLineRendererPoints12",new _),t(this,"_trendLineRendererPoints43",new _),t(this,"_disjointChannelRenderer",new x),t(this,"_renderer",new m(this._hitTestCollector))}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this.points();if((null==e?void 0:e.length)<2)return;const[t,s]=e,r=this._source.properties();let o,l;3===e.length&&(o=new i(s.x,e[2].y),l=new i(t.x,o.y),r.fillBackground&&(this._disjointChannelRenderer.setData({extendleft:r.extendLeft,extendright:r.extendRight,points:[t,s,o,l],backcolor:r.backgroundColor,fillBackground:r.fillBackground}),this._renderer.append(this._disjointChannelRenderer)));const a=(e,t)=>({points:[e,t],lineColor:r.lineColor,lineWidth:r.lineWidth,lineStyle:r.lineStyle,extendLeft:r.extendLeft,extendRight:r.extendRight,leftEnd:r.leftEnd,rightEnd:r.rightEnd});if(this._trendLineRendererPoints12.setData(a(t,s)),this._renderer.append(this._trendLineRendererPoints12),2===e.length)return void this.addAnchors(this._renderer);if(!o||!l)return void this.addAnchors(this._renderer);this._trendLineRendererPoints43.setData(a(l,o)),this._renderer.append(this._trendLineRendererPoints43);const d=[t,s,new n(o,{pointIndex:2}),new n(l,{pointIndex:3})];this._model.currentCreating===this._source&&d.pop(),this._renderer.append(this.createLineAnchor({points:d},0))}}class f extends l{constructor(){super(...arguments),t(this,"_lines",new w(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new p(Object.create(null))]),t(this,"_timeAxisPaneViews",[new u(Object.create(null))]),t(this,"_timeAxisViews",[new c(Object.create(null)),new c(Object.create(null)),new c(Object.create(null))]),t(this,"_priceAxisViews",[new h(Object.create(null)),new h(Object.create(null)),new h(Object.create(null))])}pointsCount(){return 3}setPoint(e,t,i){if(2===e)this.controlPoints[1].time=t.time;else if(3===e)return this.controlPoints[0].time=t.time,void(this.controlPoints[2].price=t.price);super.setPoint(e,t,i)}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let s=0;s<this.controlPoints.length;s++){const t=this.controlPoints[s],i=this.pointToScreenPoint(t);if(!i)return;e.push(new n(i,{pointIndex:s}))}const t=e.map((e=>e.x)),i=e.map((e=>e.y));this.controlPoints.forEach(((t,i)=>{this._timeAxisViews[i].update(this._calculateTimeAxisViewData(t.time,e[i].x)),this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,e[i].y))})),t.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,t),Math.max.apply(null,t))),i.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,i),Math.max.apply(null,i))),this._lines.update({points:e})}}class P extends a{constructor(){super(...arguments),t(this,"type",d)}createPrimitive(){return new f({id:this.id,points:[],lineColor:"#FF9800FF",lineStyle:r.solid,lineWidth:2,fillBackground:!0,backgroundColor:"#FF980033",extendLeft:!1,extendRight:!1,leftEnd:s.Normal,rightEnd:s.Normal},...this.resetArgs)}}export{P as FlatTopBottomTool};
