var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{u as i,bH as s,r as o,y as n,z as r,bD as l,bG as a,e as c,bM as h,c8 as f,cb as p,A as d,L as m}from"./index-5gyre0hA.js";import{T as x,a as w,D as g}from"./toolPaneView-BkZhzbTB.js";import{v as u}from"./index-iNH1zFVl.js";import{P as _}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as v}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as y,T as L}from"./axisPaneView-B6qY_qE1.js";import{B as b,H as T,V as A}from"./text-BhorOBkg.js";import{b as P}from"./formatter-BMswhHnL.js";import{C as j}from"./composite-CCMtJLBO.js";import{L as V}from"./line-BKuOqRrm.js";import"./baseTool-BM5mqL4_.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";import"./numericFormatter-DcPXx81O.js";class R extends l{drawImpl(e){if(null===this._data)return;const t=e.context,i=this._getVisiblePolygon(e.mediaSize);if(null!==i){t.beginPath(),t.moveTo(i[0].x,i[0].y);for(let e=1;e<i.length;e++)t.lineTo(i[e].x,i[e].y);t.fillStyle=a(this._data.color,this._data.transparency,!0),t.fill()}}_getVisiblePolygon(e){const t=c(this._data),{p1:s,p2:o,p3:n,p4:r}=t;if(h(s,o)||h(n,r)||f(s,o,n).distance<1e-6&&f(s,o,r).distance<1e-6)return null;if(e.width<=0||e.height<=0)return null;let l=[new i(0,0),new i(e.width,0),new i(e.width,e.height),new i(0,e.height)];l=p(l,s,o,[r,n]),l=p(l,r,n,[s,o]);return!h(n,s)&&!t.extendLeft&&(l=p(l,n,s,[o,r])),l}}class D extends x{constructor(){super(...arguments),t(this,"_renderer",new j(this._hitTestCollector)),t(this,"_leftTextRenderers",new Map),t(this,"_rightTextRenderers",new Map),t(this,"_topTextRenderers",new Map),t(this,"_bottomTextRenderers",new Map)}getTextRenderers(e,t){const i={left:this._leftTextRenderers,right:this._rightTextRenderers,top:this._topTextRenderers,bottom:this._bottomTextRenderers};let s=i[e].get(t);return s||(s=new b,i[e].set(t,s)),s}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this.points();if(e.length<2)return;const t=this._source.properties(),[l,a]=e,c=Math.min(l.x,a.x),h=Math.max(l.x,a.x),f=Math.min(l.y,a.y),p=Math.max(l.y,a.y),d=t.grid.color,m=t.grid.linewidth,x=t.grid.linestyle,w=t.grid.visible,g=P();for(let n=0;n<t.hLevels.length;n++){const e=t.hLevels[n],r=this._data.hLevels[n].y,l=new i(c,r),a=new i(h,r);if(w){const e=new V;e.setData({points:[l,a],lineColor:d,lineWidth:m,lineStyle:x,extendLeft:!1,extendRight:!1,leftEnd:s.Normal,rightEnd:s.Normal}),this._renderer.append(e)}if(t.showLeftLabels){const t={points:[l],text:g.format(e.coeff),color:e.color,vertAlign:A.Middle,horzAlign:T.Right,fontFamily:o,offsetX:5,offsetY:0,fontSize:12,forceTextAlign:!0},i=this.getTextRenderers("left",n);i.setData(t),this._renderer.append(i)}if(t.showRightLabels){const t={points:[a],text:g.format(e.coeff),color:e.color,vertAlign:A.Middle,horzAlign:T.Left,fontFamily:o,offsetX:5,offsetY:0,fontSize:12,forceTextAlign:!0},i=this.getTextRenderers("right",n);i.setData(t),this._renderer.append(i)}}for(let n=0;n<t.vLevels.length;n++){const e=t.vLevels[n],r=this._data.vLevels[n].x,l=new i(r,f),a=new i(r,p);if(w){const e=new V;e.setData({points:[l,a],lineColor:d,lineWidth:m,lineStyle:x,extendLeft:!1,extendRight:!1,leftEnd:s.Normal,rightEnd:s.Normal}),this._renderer.append(e)}if(t.showTopLabels){const t={points:[l],text:g.format(e.coeff),color:e.color,vertAlign:A.Bottom,horzAlign:T.Center,fontFamily:o,offsetX:0,offsetY:5,fontSize:12},i=this.getTextRenderers("top",n);i.setData(t),this._renderer.append(i)}if(t.showBottomLabels){const t={points:[a],text:g.format(e.coeff),color:e.color,vertAlign:A.Top,horzAlign:T.Center,fontFamily:o,offsetX:0,offsetY:5,fontSize:12},i=this.getTextRenderers("bottom",n);i.setData(t),this._renderer.append(i)}}const u=t.fillBackground,_=t.transparency;for(let o=0;o<t.hLevels.length;o++){const e=this._data.hLevels[o].y,c=o>0?this._data.hLevels[o-1].y:null;if(o>0&&u){const s=new R;s.setData({p1:l,p2:new i(a.x,e),p3:l,p4:new i(a.x,c),color:t.hLevels[o].color,transparency:_,hittestOnBackground:!0,extendLeft:!1}),this._renderer.append(s)}const h=new V;h.setData({points:[l,new i(a.x,e)],lineColor:t.hLevels[o].color,lineWidth:t.linewidth,lineStyle:t.linestyle,extendLeft:!1,extendRight:!0,leftEnd:s.Normal,rightEnd:s.Normal}),h.setHitTest(new n(r.MovePoint)),this._renderer.append(h)}for(let o=0;o<t.vLevels.length;o++){const e=this._data.vLevels[o].x,c=o>0?this._data.vLevels[o-1].x:null;if(o>0&&u){const s=new R;s.setData({p1:l,p2:new i(e,a.y),p3:l,p4:new i(c,a.y),color:t.vLevels[o].color,transparency:_,hittestOnBackground:!0,extendLeft:!1}),this._renderer.append(s)}const h=new V;h.setData({points:[l,new i(e,a.y)],lineColor:t.vLevels[o].color,lineWidth:t.linewidth,lineStyle:t.linestyle,extendLeft:!1,extendRight:!0,leftEnd:s.Normal,rightEnd:s.Normal}),h.setHitTest(new n(r.MovePoint)),this._renderer.append(h)}this.addAnchors(this._renderer)}}class M extends w{constructor(){super(...arguments),t(this,"_lines",new D(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new y(Object.create(null))]),t(this,"_timeAxisPaneViews",[new L(Object.create(null))]),t(this,"_timeAxisViews",[new v(Object.create(null)),new v(Object.create(null))]),t(this,"_priceAxisViews",[new _(Object.create(null)),new _(Object.create(null))])}pointsCount(){return 2}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let n=0;n<this.controlPoints.length;n++){const t=this.controlPoints[n],i=this.pointToScreenPoint(t);if(!i)return;e.push(new d(i,{pointIndex:n}))}const t=e.map((e=>e.x)),i=e.map((e=>e.y));this.controlPoints.forEach(((t,i)=>{this._timeAxisViews[i].update(this._calculateTimeAxisViewData(t.time,e[i].x)),this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,e[i].y))})),t.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,t),Math.max.apply(null,t))),i.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,i),Math.max.apply(null,i)));let s=[],o=[];if(e.length>1){const[e,t]=this.controlPoints,i=this._props.reverse,n=i?t.price-e.price:e.price-t.price,r=i?e.price:t.price;s=this._props.hLevels.reduce(((e,t)=>{const i=t.coeff,s=r+i*n,o=c(this.series.priceToCoordinate(s));return e.push({y:o}),e}),[]);const l=c(this.chart.timeScale().timeToIndexEx(e.time)),a=c(this.chart.timeScale().timeToIndexEx(t.time)),h=i?a-l:l-a,f=i?l:a;o=this._props.vLevels.reduce(((e,t)=>{const i=t.coeff,s=Math.round(f+i*h),o=c(this.chart.timeScale().logicalToCoordinate(s));return e.push({x:o}),e}),[])}this._lines.update({points:e,hLevels:s,vLevels:o})}}class C extends g{constructor(){super(...arguments),t(this,"type",u)}createPrimitive(){return new M({id:this.id,points:[],fillBackground:!0,transparency:80,grid:{color:"rgba(21, 56, 153, 0.8)",linewidth:1,linestyle:m.solid,visible:!0},linewidth:2,linestyle:m.solid,showTopLabels:!0,showBottomLabels:!0,showLeftLabels:!0,showRightLabels:!0,reverse:!1,hLevels:[{coeff:0,color:"#808080"},{coeff:.25,color:"#FF9800"},{coeff:.382,color:"#00BCD4"},{coeff:.5,color:"#4CAF50"},{coeff:.618,color:"#089981"},{coeff:.75,color:"#2962FF"},{coeff:1,color:"#808080"}],vLevels:[{coeff:0,color:"#808080"},{coeff:.25,color:"#FF9800"},{coeff:.382,color:"#00BCD4"},{coeff:.5,color:"#4CAF50"},{coeff:.618,color:"#089981"},{coeff:.75,color:"#2962FF"},{coeff:1,color:"#808080"}]},...this.resetArgs)}}export{C as FibSpeedResistanceFanTool};
