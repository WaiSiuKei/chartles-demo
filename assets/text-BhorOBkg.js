var t=Object.defineProperty,e=(e,i,n)=>((e,i,n)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n)(e,"symbol"!=typeof i?i+"":i,n);import{B as i,aX as n,e as o,u as a,aY as s,aZ as r,L as h,a_ as l,y as d,z as c,M as x,G as f,s as u,a$ as g,w as _,v as b,b0 as p,a as w,b1 as P,b2 as y}from"./index-5gyre0hA.js";import{m,i as L}from"./text-BFLAaZ9z.js";import{d as v}from"./ctx-BQtFq0AI.js";var W=(t=>(t.Left="left",t.Center="center",t.Right="right",t))(W||{}),T=(t=>(t.Top="top",t.Middle="middle",t.Bottom="bottom",t))(T||{});function M(t){let e,i;return t>=-135&&t<=-45?(e="center",i="bottom"):t>-45&&t<45?(e="left",i="middle"):t>=45&&t<=135?(e="center",i="top"):(e="right",i="middle"),{horzAlign:e,vertAlign:i}}class S extends i{constructor(t){super(),e(this,"_internalData",null),e(this,"_boxSize",null),e(this,"_linesInfo",null),e(this,"_fontInfo",null),e(this,"_centerTextRotationPoint",null),e(this,"_polygonPoints",null),e(this,"_rotationPoint",null),e(this,"_box",null),e(this,"_textWidthCache",new n),this._hitTestResult=t}setHitTestResult(t){this._hitTestResult=t}drawImpl(t){var e;if(!this._data||!this._data.points||0===this._data.points.length)return;const{mediaSize:i,horizontalPixelRatio:n,verticalPixelRatio:l,context:d}=t;if(this.isOutOfScreen(i.width,i.height))return;const c=this._getInternalData(),x=o(this.rotation()),f=new a(x.x*n,x.y*l);d.save(),0!==x.angle&&(d.translate(f.x,f.y),d.rotate(x.angle),d.translate(-f.x,-f.y));const u=this._getFontInfo().fontSize;d.textBaseline=c.textBaseLine,d.textAlign=c.textAlign,d.font=this.fontStyle();const{scaledLeft:g,scaledRight:_,scaledTop:b,scaledBottom:p}=function(t,e){const{horizontalPixelRatio:i,verticalPixelRatio:n}=e,o=Math.round(t.boxLeft*i),a=Math.round(t.boxTop*n),s=Math.round(t.boxWidth*i),r=Math.round(t.boxHeight*n);return{scaledLeft:o,scaledRight:o+s,scaledTop:a,scaledBottom:a+r}}(c,t),{backgroundColor:w,borderColor:P,highlightBorder:y,wordWrapWidth:m,borderWidth:L,backgroundRoundRect:W,boxShadow:T,highlightBorderColor:M,color:S,skipTextDrawing:R}=this._data;if(w||P||y&&m){const t=L||Math.max(u/12,1),e=Math.round(t*n),i=e/2;let o=!1;if(T){d.save();const{shadowColor:t,shadowBlur:e,shadowOffsetX:i=0,shadowOffsetY:n=0}=T;d.shadowColor=t,d.shadowBlur=e,d.shadowOffsetX=i,d.shadowOffsetY=n,o=!0}const a=g,l=b,c=_-g,x=p-b;if(W)w&&(s(d,a,l,c,x,W*n),d.fillStyle=w,d.fill(),o&&(d.restore(),o=!1)),P&&(s(d,a-i,l-i,c+e,x+e,W*n+e),d.strokeStyle=P,d.lineWidth=e,d.stroke(),o&&d.restore());else if(w&&(d.fillStyle=w,d.fillRect(a,l,c,x),o&&(d.restore(),o=!1)),P||y){let t;P?(d.strokeStyle=P,t=e):(d.strokeStyle=M||S,r(d,h.dashed),t=Math.max(1,Math.floor(n))),d.lineWidth=t,d.beginPath(),d.moveTo(g-t/2,b-t/2),d.lineTo(g-t/2,p+t/2),d.lineTo(_+t/2,p+t/2),d.lineTo(_+t/2,b-t/2),d.lineTo(g-t/2,b-t/2),d.stroke(),o&&d.restore()}}if(!R){d.fillStyle=this._data.color;const t=(g+Math.round(c.textHorizStart*n))/n,e=.05*u;let i=(b+Math.round((c.textVertStart+e)*l))/l;const o=H(this._data),a=this.getLinesInfo();for(const s of a.lines)v(d,n,l,(()=>{d.fillText(s.text,t,i)})),i+=u+o}null==(e=this._data.decorator)||e.draw(d,t,this._data,c),d.restore()}hitTest(t){if(!this._data||void 0===this._data.points||0===this._data.points.length)return null;return l(t,this.getPolygonPoints())?this._hitTestResult??new d(c.MovePoint,{cursorType:f.text,areaName:x.Text}):null}setData(t){return t&&(u(!t.decorator||void 0===t.wordWrapWidth,"Decorator is not supported with wordWrapWidth"),g(this._data,t)||(this._internalData=null,this._boxSize=null,this._polygonPoints=null,this._centerTextRotationPoint=null,this._rotationPoint=null,this._linesInfo=null,this._fontInfo=null,this._box=null)),super.setData(t)}setPoint(t,e,i){const n=o(this._data);this.setData({...n,points:[t],offsetX:e??n.offsetX,offsetY:i??n.offsetY})}point(){var t,e;return(null==(e=null==(t=this._data)?void 0:t.points)?void 0:e[0])??null}rect(){if(!this._data)return{x:0,y:0,width:0,height:0};const{boxLeft:t,boxTop:e,boxWidth:i,boxHeight:n}=this._getBox();return{x:t,y:e,width:i,height:n}}measure(){if(!this._data)return{width:0,height:0};const t=this._getBoxSize();return{width:t.boxWidth,height:t.boxHeight}}fontStyle(){return this._data?this._getFontInfo().fontStyle:""}lineHeight(){return this._data?R(this._data):0}lineSpacing(){return this._data?H(this._data):0}rotation(){if(null===this._rotationPoint&&null!==this._data){const t=this._data.angle??0,e=this._getRotationPoint();this._rotationPoint={x:e.x,y:e.y,angle:t}}return this._rotationPoint}isOutOfScreen(t,e){if(!this._data||!this._data.points||0===this._data.points.length)return!0;const i=this._getInternalData();if(i.boxLeft+i.boxWidth<0||i.boxLeft>t){const i=_(new a(0,0),new a(t,e));return this.getPolygonPoints().every((t=>!b(t,i)))}return!1}getPolygonPoints(){if(null!==this._polygonPoints)return this._polygonPoints;if(null===this._data)return[];const t=this._data.angle||0,{boxLeft:e,boxTop:i,boxWidth:n,boxHeight:o}=this._getInternalData(),s=this._getRotationPoint(),r=new a(e,i),h=new a(e+n,i),l=new a(e+n,i+o),d=new a(e,i+o),c=[Y(r,s,t),Y(h,s,t),Y(l,s,t),Y(d,s,t)];return this._polygonPoints=c,c}_getFontInfo(){if(null===this._fontInfo){const t=o(this._data),e=R(t),i=(t.bold?"bold ":"")+(t.italic?"italic ":"")+e+"px "+t.fontFamily;this._fontInfo={fontStyle:i,fontSize:e}}return this._fontInfo}getLinesInfo(){if(null===this._linesInfo){const t=o(this._data),e=X(t.text,this.fontStyle(),this._textWidthCache,!1,t.wordWrapWidth);let i=e.filter((t=>!t.hidden));if(void 0!==t.maxHeight){const e=(()=>{const e=o(t.maxHeight),i=R(t),n=H(t);return Math.floor((e+n)/(i+n))})();i.length>e&&(i=i.slice(0,e))}this._linesInfo={linesMaxWidth:this._getLinesMaxWidth(i),linesIncludingHidden:e,lines:i}}return this._linesInfo}_getBoxSize(){if(null===this._boxSize){const t=this.getLinesInfo(),e=o(this._data),i=function(t,e){var i;const n=null==(i=t.decorator)?void 0:i.geometry(t),o=Math.round(e+A(t)+D(t)+((null==n?void 0:n.width)??0)+(0===t.text.length?0:(null==n?void 0:n.decoratorAndTextMargin)??0));return o%2==0?o:o+1}(e,t.linesMaxWidth),n=function(t,e){return R(t)*e+H(t)*(e-1)+2*I(t)}(e,t.lines.length);this._boxSize={textBoxWidth:i,textBoxHeight:n,boxWidth:e.boxWidth??i,boxHeight:e.boxHeight??n}}return this._boxSize}_getBox(){if(this._box)return this._box;const t=o(this._data),[e]=o(t.points),{boxWidth:i,boxHeight:n,textBoxWidth:a,textBoxHeight:s}=this._getBoxSize();let{x:r,y:h}=e;switch(t.vertAlign){case T.Bottom:h-=n+t.offsetY;break;case T.Middle:h-=n/2;break;case T.Top:h+=t.offsetY}switch(t.horzAlign){case W.Left:r+=t.offsetX;break;case W.Center:r-=i/2;break;case W.Right:r-=i+t.offsetX}return this._box={boxLeft:r,boxTop:h,boxWidth:i,boxHeight:n,textBoxWidth:a,textBoxHeight:s},this._box}_getLinesMaxWidth(t){const e=this.fontStyle();if(this._data&&this._data.wordWrapWidth&&!this._data.forceCalculateMaxLineWidth)return this._data.wordWrapWidth*z(this._data);let i=0;for(const n of t){const t=m(n.text,e,this._textWidthCache).width;i=Math.max(i,t)}return i}_getInternalData(){var t;if(null!==this._internalData)return this._internalData;const e=o(this._data),i=this._getBoxSize(),n=i.boxWidth,a=i.boxHeight,s=o(e.points)[0];let r=s.y;switch(e.vertAlign){case"bottom":r-=a+e.offsetY;break;case"middle":r-=a/2;break;case"top":r+=e.offsetY}let h=s.x;const l=A(e),d=D(e),c=I(e),x=null==(t=e.decorator)?void 0:t.geometry(e),f=(null==x?void 0:x.width)??0,u=0===e.text.length?0:(null==x?void 0:x.decoratorAndTextMargin)??0,g=null==x?void 0:x.ignoreRtl,_=f+u,b=r+c+R(e)/2;switch(e.horzAlign){case"left":h+=e.offsetX;break;case"center":h-=n/2;break;case"right":h-=n+e.offsetX}const w=L(),P=w&&!g;(w||P)&&p();const y=P?h+n-d-f:h+l;let m="start",v=0;switch(o(e.horzAlign)){case"left":m="start",v=P?e.forceTextAlign?y:h+n-d:y+_,w&&e.forceTextAlign?m="left":P&&(v=y-u,m="right");break;case"center":{m="center";const t=n-l-d-_;v=P?y-u-t/2:y+_+t/2;break}case"right":m="end",v=P?y-u:h+n-d,w&&e.forceTextAlign&&(m="right")}const W={boxLeft:h,boxTop:r,boxWidth:n,boxHeight:a,textLeft:h+l+(P?0:_),textRight:h+n-d-(P?_:0),textTop:r+c,textBottom:r+a-c,textHorizStart:v-h,textVertStart:b-r,textAlign:m,textBaseLine:"middle",decoratorLeft:y,decoratorWidth:f};return this._internalData=W}centerTextRotation(){if(null===this._centerTextRotationPoint&&this._data){const t=this._data.angle??0,e=this._getRotationPoint(),{textLeft:i,textTop:n,textRight:o,textBottom:s}=this._getInternalData(),r=Y(new a((i+o)/2,(n+s)/2),e,t);this._centerTextRotationPoint={x:r.x,y:r.y,angle:t}}return this._centerTextRotationPoint??void 0}_getRotationPoint(){const{boxLeft:t,boxTop:e,boxWidth:i,boxHeight:n}=this._getInternalData(),{horzAlign:s,vertAlign:r}=o(this._data);let h,l;switch(s){case"center":h=t+i/2;break;case"left":h=t;break;case"right":h=t+i}switch(r){case"middle":l=e+n/2;break;case"top":l=e;break;case"bottom":l=e+n}return new a(h,l)}}function R(t){return Math.ceil(B(t)*z(t))}function B(t){return t.fontSize}function z(t){const e=Math.min(1,Math.max(.2,t.scale||1));if(1===e)return e;const i=B(t);return Math.ceil(e*i)/i}function H(t){let e=t.lineSpacing;return void 0===e&&void 0!==t.lineHeight&&(e=(t.lineHeight-1)*B(t)),(e??0)*z(t)}function I(t){return void 0!==t.boxPaddingVert?t.boxPaddingVert*z(t):void 0!==t.boxPadding?t.boxPadding*z(t):R(t)/3}function k(t){return void 0!==t.boxPaddingHorz?t.boxPaddingHorz*z(t):void 0!==t.boxPadding?t.boxPadding*z(t):R(t)/3}function A(t){return void 0!==t.boxPaddingLeft?t.boxPaddingLeft*z(t):k(t)}function D(t){return void 0!==t.boxPaddingRight?t.boxPaddingRight*z(t):k(t)}function C(t){const e=[];for(;t.length>0;){const i=t.match(/\s+/);if(!i||void 0===i.index||-1===i.index){e.push({word:t,spaces:""});break}const n=t.slice(0,i.index),o=i[0];e.push({word:n,spaces:o}),t=t.slice(i.index+o.length)}return e}function O(t,e,i,n){const o=[],a=[];for(let s=0;s<t.length;++s)a.push(s);for(;t.length>0;){const s=Math.max(1,y(a,n,((n,o)=>m(t.slice(0,o+1),e,i).width>n),0,t.length));o.push(t.slice(0,s)),t=t.slice(s)}return o}function X(t,e,i,n=!0,o){const a=P(o)?parseInt(o):o,s=(t+"").split(/\r\n|\r|\n|$/).map((t=>({text:t,hidden:!1,wrappedLinePart:!1,wrappedLineEnd:!1})));if(!w(a)||!isFinite(a)||a<=0)return s;if(m("x",e,i).width>a)return s;const r=[];for(let h=0;h<s.length;h++){const t=s[h];if(m(t.text,e,i).width<=a){r.push(t);continue}const o=C(t.text),l=!0;let d="",c=0;for(;c<o.length;){const t=o[c];let s=d+t.word,h=m(s,e,i).width;if(h>a){if(""!==d)r.push({text:d,hidden:!1,wrappedLinePart:l,wrappedLineEnd:!1}),d="";else if(1===s.length)r.push({text:s,hidden:!1,wrappedLinePart:l,wrappedLineEnd:!0}),t.word="";else{const n=O(s,e,i,a);for(let t=0;t<n.length-1;t++)r.push({text:n[t],hidden:!1,wrappedLinePart:l,wrappedLineEnd:!1});t.word=n[n.length-1]}continue}if(s=d+t.word+t.spaces,h=m(s,e,i).width,h<a){d=s,c++;continue}const x=O(s,e,i,a);for(let e=0;e<x.length;e++){const t={text:x[e],hidden:e>0,wrappedLinePart:l,wrappedLineEnd:c===o.length-1&&e===x.length-1};t.hidden&&!n||r.push(t)}d="",c++}""!==d&&r.push({text:d,wrappedLinePart:l,hidden:!1,wrappedLineEnd:!0})}return r}function Y(t,e,i){if(0===i)return t.clone();const n=t.x-e.x,o=t.y-e.y,s=n*Math.cos(i)-o*Math.sin(i)+e.x,r=n*Math.sin(i)+o*Math.cos(i)+e.y;return new a(s,r)}function E(t,e,i){if(t.isOutOfScreen(e,i))return null;const n=t.getPolygonPoints();return 0===n.length?null:n}function F(t,e,i,n,o){const s=.5*(e.x+i.x);let r=i.y;return e.y>i.y?(r-=t.height/2+n.y,r=Math.max(t.height/2,r)):(r+=t.height/2+n.y,r=Math.min(o-t.height/2,r)),new a(s,r)}function V(t){const{horzAlign:e,extendLeft:i=!1,extendRight:n=!1,width:o,leftPoint:s,rightPoint:r}=t,h=(s.x<=o||i)&&(r.x>=0||n);let l,d,c=e;switch(e){case W.Left:d=s.y,i?l=h?0:r.x:(l=s.x,c=W.Right);break;case W.Right:d=r.y,n?l=h?o:s.x:(l=r.x,c=W.Left);break;default:l=((i&&h?0:s.x)+(n&&h?o:r.x))/2,d=(s.y+r.y)/2}return[new a(l,d),c]}function j(t){const e=t.getLinesInfo().lines;return e.length%2!=0&&""!==e[Math.floor(e.length/2)].text.trim()}export{S as B,W as H,T as V,R as a,V as b,F as c,H as d,M as e,E as g,j as n,X as w};
