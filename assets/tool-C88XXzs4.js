var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{y as i,z as s,bH as r,bD as l,cj as n,bG as o,bK as a,A as c,u as d,L as h}from"./index-5gyre0hA.js";import{a as u,D as p}from"./toolPaneView-BkZhzbTB.js";import{u as f}from"./index-iNH1zFVl.js";import{P as m}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as b}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as w,T as _}from"./axisPaneView-B6qY_qE1.js";import{V as v,H as x}from"./text-BhorOBkg.js";import{C as P}from"./composite-CCMtJLBO.js";import{L as y}from"./line-BKuOqRrm.js";import{F as g}from"./paneView-MhvZ7TYs.js";import"./baseTool-BM5mqL4_.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";import"./formatter-BMswhHnL.js";import"./numericFormatter-DcPXx81O.js";class j extends l{hitTest(e){const t=this._data;if(null===t)return null;if(n(e.y-t.center.y)!==t.dir&&!t.fullCircles)return null;const i=e.subtract(t.center).length(),s=a().curve;return Math.abs(i-t.radius)<s?this._hitTest:t.hittestOnBackground&&Math.abs(i)<=t.radius+s?this._backgroundHitTest:null}drawImpl(e){const t=this._data;if(!t)return;const i=e.context;i.lineCap="round",i.strokeStyle=t.color,i.lineWidth=t.linewidth,i.translate(t.center.x,t.center.y),i.beginPath(),t.fullCircles?i.arc(0,0,t.radius,0,2*Math.PI,!1):t.dir>0?i.arc(0,0,t.radius,0,Math.PI,!1):i.arc(0,0,t.radius,Math.PI,0,!1),i.stroke(),t.fillBackground&&(t.radius2&&(t.fullCircles?i.arc(0,0,t.radius2,0,2*Math.PI,!0):t.dir>0?i.arc(0,0,t.radius2,Math.PI,0,!0):i.arc(0,0,t.radius2,0,Math.PI,!0)),i.fillStyle=o(t.color,t.transparency,!0),i.fill())}}class A extends g{constructor(){super(...arguments),t(this,"_trendLineRenderer",new y),t(this,"_renderer",new P(this._hitTestCollector))}renderer(){return this._renderer}_updateImpl(){var e;this._renderer.clear();const t=this.points();if((null==t?void 0:t.length)<2)return;const l=this._source.properties(),n=t[0],o=t[1],a=l.fillBackground,c=l.transparency,d=l.fullCircles;for(let r=0;r<this._data.levels.length;r++){const t=this._data.levels[r],o={center:n,color:l.levels[r].color,linewidth:l.levelsStyle.linewidth,radius:t.radius,dir:t.dir,transparency:c,fillBackground:a,hittestOnBackground:!0,fullCircles:d,radius2:r>0?null==(e=this._data.levels[r-1])?void 0:e.radius:void 0},h=new i(s.MovePoint),u=new j(o);u.setHitTest(h),this._renderer.append(u);const p=this._updateLabelForLevel({levelIndex:r,coeff:l.levels[r].coeff,leftPoint:t.labelPoint,rightPoint:t.labelPoint,price:"",color:l.levels[r].color,horzAlign:x.Left,vertAlign:v.Middle});null!==p&&this._renderer.append(p)}const h=l.trendline;if(h.visible){const e={points:[n,o],lineColor:h.color,lineWidth:h.linewidth,lineStyle:h.linestyle,extendLeft:!1,extendRight:!1,leftEnd:r.Normal,rightEnd:r.Normal};this._trendLineRenderer.setData(e),this._renderer.append(this._trendLineRenderer)}this.addAnchors(this._renderer)}}class V extends u{constructor(){super(...arguments),t(this,"_lines",new A(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new w(Object.create(null))]),t(this,"_timeAxisPaneViews",[new _(Object.create(null))]),t(this,"_timeAxisViews",[new b(Object.create(null)),new b(Object.create(null))]),t(this,"_priceAxisViews",[new m(Object.create(null)),new m(Object.create(null))])}pointsCount(){return 2}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let r=0;r<this.controlPoints.length;r++){const t=this.controlPoints[r],i=this.pointToScreenPoint(t);if(!i)return;e.push(new c(i,{pointIndex:r}))}const t=e.map((e=>e.x)),i=e.map((e=>e.y));this.controlPoints.forEach(((t,i)=>{this._timeAxisViews[i].update(this._calculateTimeAxisViewData(t.time,e[i].x)),this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,e[i].y))})),t.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,t),Math.max.apply(null,t))),i.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,i),Math.max.apply(null,i)));let s=[];if(e.length>1){const t=e[0],i=e[1],r=t.subtract(i).length();s=this._props.levels.reduce(((e,s)=>{if(!s.visible)return e;const l=s.coeff,o=Math.abs(r*l),a=n(i.y-t.y),c=new d(t.x,t.y+a*o);return e.push({radius:o,dir:a,labelPoint:c}),e}),[])}this._lines.update({points:e,levels:s})}}class M extends p{constructor(){super(...arguments),t(this,"type",f)}createPrimitive(){return new V({id:this.id,points:[],showCoeffs:!0,fillBackground:!0,transparency:80,fullCircles:!1,trendline:{visible:!0,color:"#808080",linewidth:2,linestyle:h.dashed},levelsStyle:{linewidth:2,linestyle:h.solid},levels:[{visible:!0,coeff:.236,color:"#F23645"},{visible:!0,coeff:.382,color:"#FF9800"},{visible:!0,coeff:.5,color:"#4CAF50"},{visible:!0,coeff:.618,color:"#089981"},{visible:!0,coeff:.786,color:"#00BCD4"},{visible:!0,coeff:1,color:"#808080"},{visible:!0,coeff:1.618,color:"#2962FF"},{visible:!0,coeff:2.618,color:"#E91E63"},{visible:!0,coeff:3.618,color:"#2962FF"},{visible:!0,coeff:4.236,color:"#E91E63"},{visible:!0,coeff:4.618,color:"#F23645"}]},...this.resetArgs)}}export{M as FibSpeedResistanceArcsTool};
