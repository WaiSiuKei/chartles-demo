var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{T as i,a as s,D as r}from"./toolPaneView-BkZhzbTB.js";import{au as o}from"./index-iNH1zFVl.js";import{r as a,bV as n,z as l,bD as h,w as c,u as d,v as p,y as u,A as _}from"./index-5gyre0hA.js";import{P as f}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as m}from"./timeLabelTimeAxisView-DLVMuesT.js";import{c as b,i as w}from"./text-BFLAaZ9z.js";import{m as x}from"./font-DVjjKW8j.js";import{C as g}from"./composite-CCMtJLBO.js";import"./baseTool-BM5mqL4_.js";class T extends h{constructor(){super(...arguments),t(this,"_measureCache",null)}drawImpl(e){if(null===this._data||0===this._data.points.length)return;const t=e.context;t.font=this._data.font;const i=t.measureText(this._data.label),s=this._data.fontSize,r=i.width+20,o=s+10,a=this._data.points[0].x+9,n=this._data.points[0].y-(o+15),l=b(t,i.width);this._measureCache={innerWidth:r,innerHeight:o,tailLeft:-9,tailHeight:15},t.textAlign=w()?"right":"left",t.translate(a,n),t.beginPath(),t.moveTo(12,o),t.lineTo(-9,o+15),t.lineTo(5,o),t.lineTo(3,o),t.arcTo(0,o,0,0,3),t.lineTo(0,3),t.arcTo(0,0,r,0,3),t.lineTo(r-3,0),t.arcTo(r,0,r,o,3),t.lineTo(r,o-3),t.arcTo(r,o,0,o,3),t.lineTo(12,o),t.fillStyle=this._data.backgroundColor,t.fill(),t.strokeStyle=this._data.borderColor,t.lineWidth=2,t.stroke(),t.closePath(),t.textBaseline="alphabetic",t.fillStyle=this._data.color;const h=10+l,c=o/2+Math.floor(.35*s);t.fillText(this._data.label,h,c),t.beginPath(),t.arc(-9,o+15,2.5,0,2*Math.PI,!1),t.fillStyle=this._data.borderColor,t.fill(),t.strokeStyle="#ffffff",t.lineWidth=1,t.stroke(),t.closePath()}hitTest(e){if(null===this._data||0===this._data.points.length||!this._measureCache)return null;const t=this._data.points[0].x,i=this._data.points[0].y,s=t-this._measureCache.tailLeft,r=i-(this._measureCache.innerHeight+this._measureCache.tailHeight),o=c(new d(s,r),new d(s+this._measureCache.innerWidth,r+this._measureCache.innerHeight));return p(e,o)?new u(l.MovePoint):null}}class C extends i{constructor(){super(...arguments),t(this,"_renderer",new g(this._hitTestCollector)),t(this,"_priceLabelRenderer",new T)}renderer(){return this._renderer}_updateImpl(){if(this._renderer.clear(),!this._data)return;this._renderer.clear();const e=this._source.properties(),t=e.fontSize,i={points:this.points(),borderColor:e.borderColor,backgroundColor:e.backgroundColor,color:e.color,font:x(t,a,"",e.fontWeight),fontSize:t,label:this._data.label};this._priceLabelRenderer.setData(i),this._renderer.append(this._priceLabelRenderer),this._renderer.append(new n({points:this.points(),bgColors:this._lineAnchorColors(i.points),visible:this.areAnchorsVisible(),hitTarget:l.MovePoint}))}}class P extends s{constructor(){super(...arguments),t(this,"_lines",new C(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_timeAxisViews",[new m(Object.create(null))]),t(this,"_priceAxisViews",[new f(Object.create(null))])}pointsCount(){return 1}updateAllViews(){if(!this.controlPoints.length)return;const e=[],t=this._ctx.priceLabelFormatter(this.controlPoints[0].price);for(let i=0;i<this.controlPoints.length;i++){const t=this.controlPoints[i],s=this.pointToScreenPoint(t);if(!s)return;const r=new _(s,{pointIndex:i,hitTarget:l.ChangePoint});e.push(r),this._timeAxisViews[i].update(this._calculateTimeAxisViewData(t.time,s.x)),this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,s.y))}this._lines.update({points:e,label:t})}}class A extends r{constructor(){super(...arguments),t(this,"type",o)}createPrimitive(){return new P({id:this.id,points:[],fontSize:14,fontWeight:"bold",color:"#ffffff",backgroundColor:"#2962FFFF",borderColor:"#2962FFFF"},...this.resetArgs)}}export{A as PriceLabelTool};
