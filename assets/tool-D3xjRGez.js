var e=Object.defineProperty,t=(t,i,r)=>((t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r)(t,"symbol"!=typeof i?i+"":i,r);import{bH as i,L as r,r as n,A as s,b$ as a}from"./index-5gyre0hA.js";import{T as o,a as l,D as c}from"./toolPaneView-BkZhzbTB.js";import{a3 as h}from"./index-iNH1zFVl.js";import{P as p}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as d}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as u,T as m}from"./axisPaneView-B6qY_qE1.js";import{B as w,H as f,V as _}from"./text-BhorOBkg.js";import{b}from"./formatter-BMswhHnL.js";import{C as x}from"./composite-CCMtJLBO.js";import{L as j}from"./line-BKuOqRrm.js";import{P}from"./polygon-D49cV0Ps.js";import"./baseTool-BM5mqL4_.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";import"./numericFormatter-DcPXx81O.js";class A extends o{constructor(){super(...arguments),t(this,"_renderer",new x(this._hitTestCollector)),t(this,"_retrace1LabelRenderer",new w),t(this,"_retrace12LabelRenderer",new w),t(this,"_polyLineRenderer",new P)}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this.points();if((null==e?void 0:e.length)<2)return;const t=this._source.properties(),s=(e,i)=>({points:[e],text:i,color:t.textColor,vertAlign:_.Middle,horzAlign:f.Center,fontFamily:n,offsetX:0,offsetY:0,fontSize:t.textFontSize,backgroundColor:t.lineColor,backgroundRoundRect:4}),a=(e,n)=>({points:[e,n],lineColor:t.lineColor,lineWidth:t.lineWidth,lineStyle:r.dotted,extendLeft:!1,extendRight:!1,leftEnd:i.Normal,rightEnd:i.Normal}),o={points:e,lineColor:t.lineColor,lineWidth:t.lineWidth,lineStyle:r.solid,leftEnd:i.Normal,rightEnd:i.Normal,background:"rgba(0, 0, 0, 0)",filled:!1};this._polyLineRenderer.setData(o),this._renderer.append(this._polyLineRenderer);const l=b(3);if(!isNaN(this._data.retrace1Ratio)){const t=new j;t.setData(a(e[1],e[3])),this._renderer.append(t);const i=s(e[1].add(e[3]).scaled(.5),l.format(this._data.retrace1Ratio));this._retrace1LabelRenderer.setData(i),this._renderer.append(this._retrace1LabelRenderer)}if(!isNaN(this._data.retrace2Ratio)){const t=new j;t.setData(a(e[3],e[5])),this._renderer.append(t);const i=s(e[3].add(e[5]).scaled(.5),l.format(this._data.retrace2Ratio));this._retrace12LabelRenderer.setData(i),this._renderer.append(this._retrace12LabelRenderer)}this.addAnchors(this._renderer)}}class g extends l{constructor(){super(...arguments),t(this,"_lines",new A(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new u(Object.create(null))]),t(this,"_timeAxisPaneViews",[new m(Object.create(null))]),t(this,"_timeAxisViews",[new d(Object.create(null)),new d(Object.create(null)),new d(Object.create(null)),new d(Object.create(null)),new d(Object.create(null)),new d(Object.create(null)),new d(Object.create(null))]),t(this,"_priceAxisViews",[new p(Object.create(null)),new p(Object.create(null)),new p(Object.create(null)),new p(Object.create(null)),new p(Object.create(null)),new p(Object.create(null)),new p(Object.create(null))])}pointsCount(){return 7}updateAllViews(){if(!this.controlPoints.length)return;const e=[];for(let n=0;n<this.controlPoints.length;n++){const t=this.controlPoints[n],i=this.pointToScreenPoint(t);if(!i)return;e.push(new s(i,{pointIndex:n}))}const t=e.map((e=>e.x)),i=e.map((e=>e.y));this.controlPoints.forEach(((t,i)=>{this._timeAxisViews[i].update(this._calculateTimeAxisViewData(t.time,e[i].x)),this._priceAxisViews[i].update(this._calculatePriceAxisViewData(t.price,e[i].y))})),t.length>1&&this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(Math.min.apply(null,t),Math.max.apply(null,t))),i.length>1&&this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(Math.min.apply(null,i),Math.max.apply(null,i)));const r={points:e,retrace1Ratio:NaN,retrace2Ratio:NaN};if(e.length>=4){const[,e,t,i]=this.controlPoints;r.retrace1Ratio=Math.round(100*Math.abs((i.price-t.price)/(t.price-e.price)))/100}if(e.length>=6){const[,,,e,t,i]=this.controlPoints;r.retrace2Ratio=Math.round(100*Math.abs((i.price-t.price)/(t.price-e.price)))/100}this._lines.update(r)}}class R extends c{constructor(){super(...arguments),t(this,"type",h)}createPrimitive(){return new g({id:this.id,points:[],lineColor:"#673AB7FF",lineWidth:2,background:a("#673AB7FF",.15),fillBackground:!0,textColor:"#ffffff",textFontSize:12},...this.resetArgs)}}export{R as PatternThreeDrivesTool};
