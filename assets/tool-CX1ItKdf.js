var e=Object.defineProperty,t=(t,i,r)=>((t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r)(t,"symbol"!=typeof i?i+"":i,r);import{T as i,a as r,D as s,g as n}from"./toolPaneView-BkZhzbTB.js";import{_ as o}from"./index-iNH1zFVl.js";import{L as a,u as d,bH as l,r as h,y as c,z as x,A as p,e as m}from"./index-5gyre0hA.js";import{P as u}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as w}from"./timeLabelTimeAxisView-DLVMuesT.js";import{P as _,T as f}from"./axisPaneView-B6qY_qE1.js";import{H as b,V as g,c as P}from"./text-BhorOBkg.js";import{C as A}from"./composite-CCMtJLBO.js";import{L as V}from"./line-BKuOqRrm.js";import{R}from"./rectangle-E0x1RaIQ.js";import{T as j}from"./renderer-CaYvdS1S.js";import"./baseTool-BM5mqL4_.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";class y extends i{constructor(){super(...arguments),t(this,"_leftBorderRenderer",new V),t(this,"_rightBorderRenderer",new V),t(this,"_distancePriceRenderer",new V),t(this,"_backgroundRenderer",new R),t(this,"_textRenderer",new j),t(this,"_renderer",new A(this._hitTestCollector))}renderer(){return this._renderer}_updateImpl(){if(this._renderer.clear(),this.points().length<2)return;const e=this._source.properties(),t=e.extendTop,i=e.extendBottom,[r,s]=this.points(),{mediaSize:{height:n}}=this._source.getScope(),o=t?0:Math.min(r.y,s.y),p=i?n:Math.max(r.y,s.y);this._backgroundRenderer.setData({points:[new d(r.x,o),new d(s.x,p)],color:"white",lineWidth:0,lineStyle:a.solid,backColor:e.background,extendLeft:!1,extendRight:!1}),this._renderer.append(this._backgroundRenderer);const m=(t,i,r)=>{t.setData({points:[i,r],lineColor:e.lineColor,lineWidth:e.lineWidth,lineStyle:a.solid,extendLeft:!1,extendRight:!1,leftEnd:l.Normal,rightEnd:l.Normal}),this._renderer.append(t)};m(this._leftBorderRenderer,new d(r.x,o),new d(r.x,p)),m(this._rightBorderRenderer,new d(s.x,o),new d(s.x,p));const u=Math.round((r.y+s.y)/2),w=new d(r.x,u),_=new d(s.x,u);this._distancePriceRenderer.setData({points:[w,_],lineColor:e.lineColor,lineWidth:e.lineWidth,lineStyle:a.solid,extendLeft:!1,extendRight:!1,leftEnd:l.Normal,rightEnd:Math.abs(w.x-_.x)>=15*e.lineWidth?l.Arrow:l.Normal}),this._renderer.append(this._distancePriceRenderer);const f={x:0,y:10},A=e.fontSize,V={points:this.points(),text:this._data.labelText,color:e.textColor,fontFamily:h,offsetX:f.x,offsetY:f.y,lineSpacing:8,vertAlign:g.Middle,horzAlign:b.Center,fontSize:A,backgroundRoundRect:4,boxPaddingHorz:.4*A+A/3,boxPaddingVert:.2*A+A/3,boxShadow:{shadowColor:e.boxShadow,shadowBlur:4,shadowOffsetY:1},backgroundColor:e.labelBackground};this._textRenderer.setData(V);const R=this._textRenderer.measure(),j=P(R,r,s,f,n);this._textRenderer.setPoint(j),this._textRenderer.setHitTestResult(new c(x.MovePoint)),this._renderer.append(this._textRenderer),this.addAnchors(this._renderer)}}class F extends r{constructor(){super(...arguments),t(this,"_lines",new y(this,this.model)),t(this,"_paneView",[this._lines]),t(this,"_priceAxisPaneViews",[new _(Object.create(null))]),t(this,"_timeAxisPaneViews",[new f(Object.create(null))]),t(this,"_timeAxisViews",[new w(Object.create(null)),new w(Object.create(null))]),t(this,"_priceAxisViews",[new u(Object.create(null)),new u(Object.create(null))])}pointsCount(){return 2}updateAllViews(){if(!this.controlPoints.length)return;const[e,t]=this.controlPoints;if(!t)return;const i=this.pointToScreenPoint(e);if(!i)return;const r=this.pointToScreenPoint(t);if(!r)return;const s=[new p(i,{pointIndex:0}),new p(r,{pointIndex:1})];this._timeAxisViews[0].update(this._calculateTimeAxisViewData(e.time,i.x)),this._priceAxisViews[0].update(this._calculatePriceAxisViewData(e.price,i.y)),this._timeAxisViews[1].update(this._calculateTimeAxisViewData(t.time,r.x)),this._priceAxisViews[1].update(this._calculatePriceAxisViewData(t.price,r.y)),this._priceAxisPaneViews[0].update(this._calculatePriceAxisPaneViewData(i.y,r.y)),this._timeAxisPaneViews[0].update(this._calculateTimeAxisPaneViewsData(i.x,r.x));const n=m(this.chart.timeScale().timeToIndexEx(e.time)),o=m(this.chart.timeScale().timeToIndexEx(t.time))-n,a=this._ctx.timeSpanFormatter(e.time,t.time);this._lines.update({points:s,labelText:`${this._props.formatBarCount(o)}, ${a}`})}}class T extends s{constructor(){super(...arguments),t(this,"type",o)}createPrimitive(e){return new F({id:this.id,points:[],lineColor:"#2962FFFF",lineWidth:2,background:"#2962FF26",textColor:"#000000FF",fontSize:12,labelBackground:"#FFFFFF",formatBarCount:t=>n(e).t("tool.line.common.bars",{count:t}),drawBorder:!1,borderWidth:2,borderColor:"#2962FFFF",boxShadow:"#00000033",showVolume:!1,extendTop:!1,extendBottom:!1},...this.resetArgs)}}export{T as DateRangeTool};
