var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{r as i,y as s,z as r,M as n,A as o,bV as a,e as h,aS as d}from"./index-5gyre0hA.js";import{g as p}from"./toolPaneView-BkZhzbTB.js";import{b as l,B as x,a as c}from"./textPaneView-LQytaZVw.js";import{P as u}from"./priceLabelPriceAxisView-CKrbEFjY.js";import{T as _}from"./timeLabelTimeAxisView-DLVMuesT.js";import{C as m}from"./composite-CCMtJLBO.js";import{T as f}from"./renderer-CaYvdS1S.js";import"./baseTool-BM5mqL4_.js";import"./text-BhorOBkg.js";import"./text-BFLAaZ9z.js";import"./ctx-BQtFq0AI.js";class w extends l{constructor(){super(...arguments),t(this,"_renderer",new m(this._hitTestCollector)),t(this,"_textRenderer",new f)}renderer(){return this._renderer}_updateImpl(){this._renderer.clear();const e=this._data;if(!e||0===e.points.length)return;const t=this._source.properties(),h={points:this.points(),text:this._textDisplay(),color:this._textColor(),fontSize:t.fontSize,boxPadding:t.fontSize/6,fontFamily:i,vertAlign:"top",horzAlign:"left",offsetX:0,offsetY:0};if(this._textRenderer.setData(h),this._textRenderer.setHitTestResult(new s(r.MovePoint,{areaName:n.Text,cursorType:this._textCursorType()})),this._isTextEditMode())this._updateEditor(this._textRenderer.getTextInfo());else{this._renderer.append(this._textRenderer);const t=e.points[0],i=this._textRenderer.measure(),s=i.width,n=i.height,h=new o({x:t.x+s/2,y:t.y+n});this._renderer.append(new a({points:[h],bgColors:this._lineAnchorColors([h]),visible:this.areAnchorsVisible(),hitTarget:r.MovePoint}))}}}class P extends x{constructor(){super(...arguments),t(this,"_lines",new w(this,this.model,this.editingHelper)),t(this,"_paneView",[this._lines]),t(this,"_timeAxisViews",[new _(Object.create(null))]),t(this,"_priceAxisViews",[new u(Object.create(null))]),t(this,"_fixedPoint",null)}pointsCount(){return 1}isFixed(){return this.properties().fixed}addPoint(e,t){return this.isFixed()&&(this._fixedPoint=this.pointToScreenPoint(e)),super.addPoint(e,t)}updateAllViews(){if(!this.controlPoints.length)return;const e=[],[t]=this.controlPoints,i=this.isFixed()?h(this._fixedPoint):this.pointToScreenPoint(t);if(!i)return;const s=new o(i,{pointIndex:0,hitTarget:r.ChangePoint});e.push(s),this.isFixed()||(this._timeAxisViews[0].update(this._calculateTimeAxisViewData(t.time,i.x)),this._priceAxisViews[0].update(this._calculatePriceAxisViewData(t.price,i.y))),this._lines.update({points:e})}isCreationFinished(){return this._lines.isCreationFinished()}startTextEditing(){return this._lines.startTextEditing()}}class T extends c{constructor(){super(...arguments),t(this,"type",d),t(this,"fixed",!1)}createPrimitive(e){const t=p(e);return new P({id:this.id,points:[],text:"",placeholder:t.t("tool.text.common.addText"),fontSize:14,textColor:"#2962FFFF",wordWrap:!1,fixed:this.fixed},...this.getTextResetArgs(e))}}export{T as TextTool};
